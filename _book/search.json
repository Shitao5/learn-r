[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Learn-R",
    "section": "",
    "text": "License\n\næœ¬ä¹¦ä½œä¸ºæ•´ä½“åœ¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯è¯ä¸‹æˆæƒã€‚\næœ¬ä¹¦åŒ…å«çš„ä»£ç åœ¨MIT è®¸å¯è¯ä¸‹æä¾›ï¼›è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨å¼•ç”¨æ¥æºçš„æƒ…å†µä¸‹è‡ªç”±ä½¿ç”¨ã€‚\n\n\n\n\nWickham, Hadley, and Garrett Grolemund. 2017. R for Data Science. Oâ€™Reilly Media."
  },
  {
    "objectID": "preface.html",
    "href": "preface.html",
    "title": "Preface",
    "section": "",
    "text": "æœ¬ä¹¦å†…å®¹åŒ…æ‹¬æ•°æ®å¯è§†åŒ–ã€å»ºæ¨¡ã€Shinyã€é‡‘èç­‰ã€‚"
  },
  {
    "objectID": "r-inferno.html",
    "href": "r-inferno.html",
    "title": "1Â  The R Inferno",
    "section": "",
    "text": "The R Inferno æ¥æºï¼šhttps://www.burns-stat.com/documents/books/the-r-inferno/ ã€‚"
  },
  {
    "objectID": "Visualisation.html",
    "href": "Visualisation.html",
    "title": "Visualisation",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚æ­£åœ¨è¿›è¡Œå†™ä½œå’Œç»“æ„è°ƒæ•´ï¼Œå¯èƒ½å‡ºç°æ··ä¹±æˆ–ä¸å®Œæ•´çš„æƒ…å†µã€‚"
  },
  {
    "objectID": "Visualisation.html#ggplot2",
    "href": "Visualisation.html#ggplot2",
    "title": "Visualisation",
    "section": "ggplot2",
    "text": "ggplot2\nggplot2(Wickham 2016)å…·æœ‰åº•å±‚çš„å›¾å½¢è¯­æ³•ï¼Œggplot2: Elegant Graphics for Data Analysisé‡ç‚¹è§£é‡Šäº†è¿™å¥—è¯­æ³•ï¼ŒChapterÂ 2ã€ChapterÂ 3ã€ChapterÂ 4 ä¸ºå…¶å­¦ä¹ ç¬”è®°ã€‚\nggplot2å…·æœ‰é¢œè‰²ï¼ˆcolorï¼‰ã€å¤§å°ï¼ˆsizeï¼‰ã€å½¢çŠ¶ï¼ˆshapeï¼‰ã€å¡«å……ï¼ˆfillï¼‰ç­‰ç¾å­¦å±æ€§ï¼Œé€‚ç”¨äºä¸åŒç±»å‹çš„å›¾å½¢ã€‚"
  },
  {
    "objectID": "Visualisation.html#echarts",
    "href": "Visualisation.html#echarts",
    "title": "Visualisation",
    "section": "echarts",
    "text": "echarts\nechartsæ˜¯ä¸€æ¬¾å¼€æºçš„JavaScriptå¯è§†åŒ–åº“ï¼Œå…¶åœ¨å¯äº¤äº’å›¾å½¢çš„ç»˜åˆ¶ä¸Šå…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ã€‚echarts4råŒ…(Coene 2022)æ˜¯åˆ©ç”¨Ræ“ä½œechartsè¿›è¡Œç»˜å›¾çš„å·¥å…·åŒ…ã€‚\nå…³äºJavaScriptçš„ä½¿ç”¨ï¼Œè¿˜éœ€é˜…è¯»ä¸€ä¸‹JavaScript for Rï¼Œåˆ—å…¥ä¿ºçš„TODOğŸ¢ã€‚\n\n\n\n\nCoene, John. 2022. â€œEcharts4r: Create Interactive Graphs with â€™Echarts JavaScriptâ€™ Version 5.â€ https://CRAN.R-project.org/package=echarts4r.\n\n\nWickham, Hadley. 2016. â€œGgplot2: Elegant Graphics for Data Analysis.â€ https://ggplot2.tidyverse.org."
  },
  {
    "objectID": "vis-ggplot2-layers.html",
    "href": "vis-ggplot2-layers.html",
    "title": "2Â  ggplot2-layers",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚ç›®å‰æ­£åœ¨è¿›è¡Œæ¶¦è‰²ï¼ŒåŸºæœ¬æ˜¯å¯è¯»çš„ã€‚\nåœ¨ç»˜å›¾ç¾å­¦ä¸­ï¼Œå°‘å³æ˜¯å¤šï¼Œä½¿ç”¨ç¾å­¦æ˜ å°„éœ€è¦èŠ‚åˆ¶ã€‚ä¸å…¶ç”¨ä¸€å¹…éå¸¸å¤æ‚çš„å›¾å½¢ä¸€æ¬¡å±•ç¤ºæ‰€æœ‰ï¼Œä¸å¦‚åˆ›é€ ä¸€äº›ç®€å•çš„æƒ…èŠ‚ï¼Œè®²è¿°ä¸€ä¸ªæ•…äº‹ï¼Œè®©è¯»è€…çš„è®¤è¯†ä»æ— åˆ°æœ‰ã€‚\nggplot2çš„åˆ†å±‚ç»“æ„1ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥ç»“æ„åŒ–çš„æ–¹å¼è®¾è®¡å’Œæ„å»ºå›¾å½¢ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå›¾å±‚æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼š"
  },
  {
    "objectID": "vis-ggplot2-layers.html#åŸºæœ¬å›¾å½¢",
    "href": "vis-ggplot2-layers.html#åŸºæœ¬å›¾å½¢",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.1 åŸºæœ¬å›¾å½¢",
    "text": "2.1 åŸºæœ¬å›¾å½¢\n\ndf <- data.frame(\n  x = c(3, 1, 5),\n  y = c(2, 4, 6),\n  label = c(\"a\", \"b\", \"c\")\n)\n\np <- ggplot(df, aes(x, y, label = label)) +\n  labs(x = NULL, y = NULL) +\n  theme(plot.title = element_text(size = 12))\n\np + geom_point() + ggtitle(\"point\")\np + geom_text() + ggtitle(\"text\")\np + geom_bar(stat = \"identity\") + ggtitle(\"bar\")\np + geom_tile() + ggtitle(\"raster\")\n\np + geom_line() + ggtitle(\"line\")\np + geom_area() + ggtitle(\"area\")\np + geom_path() + ggtitle(\"path\")\np + geom_polygon() + ggtitle(\"polygon\")"
  },
  {
    "objectID": "vis-ggplot2-layers.html#æ­ç¤ºä¸ç¡®å®šæ€§",
    "href": "vis-ggplot2-layers.html#æ­ç¤ºä¸ç¡®å®šæ€§",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.2 æ­ç¤ºä¸ç¡®å®šæ€§",
    "text": "2.2 æ­ç¤ºä¸ç¡®å®šæ€§\næ ¹æ®xè½´æ˜¯å¦è¿ç»­å’Œæ˜¯å¦å±•ç¤ºä¸­é—´å€¼ï¼Œæ¯”è¾ƒåŸºæœ¬çš„æœ‰ï¼š\n\ndf <- data.frame(x = 1:3,\n                 y = c(18, 11, 16),\n                 se = c(1.2, .5, 1.0))\n\nbase <- ggplot(df, aes(x, y,\n                       ymin = y - se,\n                       ymax = y + se))\nbase + geom_crossbar()\nbase + geom_pointrange()\nbase + geom_smooth(stat = \"identity\")\n\nbase + geom_errorbar()\nbase + geom_linerange()\nbase + geom_ribbon()"
  },
  {
    "objectID": "vis-ggplot2-layers.html#æƒé‡æ•°æ®",
    "href": "vis-ggplot2-layers.html#æƒé‡æ•°æ®",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.3 æƒé‡æ•°æ®",
    "text": "2.3 æƒé‡æ•°æ®\næ±‡æ€»æ•°æ®çš„æ¯ä¸€è¡Œä»£è¡¨å¤šä¸ªè§‚æµ‹å€¼ï¼Œå› æ­¤éœ€è¦è€ƒè™‘æƒé‡å˜é‡ã€‚æƒé‡å˜é‡çš„é€‰æ‹©å°†å½±å“ç»˜å›¾å’Œå¾—å‡ºçš„ç»“è®ºã€‚\nå¯¹äºç‚¹å›¾ã€çº¿å›¾ç­‰ç®€å•å›¾å½¢ï¼Œä½¿ç”¨å¤§å°ï¼ˆsizeï¼‰ç¾å­¦ã€‚\n\n# Unweighted\nggplot(midwest, aes(percwhite, percbelowpoverty)) +\n  geom_point()\n\n# Weighted by population\nggplot(midwest, aes(percwhite, percbelowpoverty)) +\n  geom_point(aes(size = poptotal / 1e6)) +\n  scale_size_area(\"Population\\n(millions)\",\n                  breaks = c(.5, 1, 2, 4))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¯¹äºæ¶‰åŠç»Ÿè®¡è½¬æ¢ç­‰å¤æ‚å›¾å½¢ï¼Œä½¿ç”¨weightç¾å­¦æŒ‡å®šæƒé‡ã€‚æƒé‡æ”¯æŒå¹³æ»‘ã€é‡åŒ–å›å½’ã€ç®±å‹å›¾ã€ç›´æ–¹å›¾ã€å¯†åº¦å›¾ç­‰æƒ…å½¢ã€‚æˆ‘ä»¬æ— æ³•ç›´æ¥ä»å›¾ä¸­çœ‹å‡ºæƒé‡å˜é‡ï¼Œå®ƒä¹Ÿä¸ä¼šäº§ç”Ÿå›¾ä¾‹ï¼Œä½†ä¼šæ”¹å˜ç»Ÿè®¡æ±‡æ€»çš„ç»“æœã€‚\n\n# Unweighted\nggplot(midwest, aes(percwhite, percbelowpoverty)) +\n  geom_point() +\n  geom_smooth(method = lm, size = 1)\n\n# Weighted by population\nggplot(midwest, aes(percwhite, percbelowpoverty)) +\n  geom_point(aes(size = poptotal / 1e6)) +\n  geom_smooth(aes(weight = poptotal), method = lm, size = 1) +\n  scale_size_area(guide = \"none\")"
  },
  {
    "objectID": "vis-ggplot2-layers.html#åœ°å›¾",
    "href": "vis-ggplot2-layers.html#åœ°å›¾",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.4 åœ°å›¾",
    "text": "2.4 åœ°å›¾\n\n\n\n\n\n\nNote\n\n\n\nè¿™é‡Œéƒ¨åˆ†å†…å®¹ä¸ç”šç†Ÿæ‚‰ï¼Œå› æ­¤æœ‰å¤§æ®µçš„åŸæ–‡ç¿»è¯‘ã€‚\n\n\nç»˜åˆ¶åœ°ç†ç©ºé—´æ•°æ®æ˜¯ä¸€é¡¹å¸¸è§çš„å¯è§†åŒ–ä»»åŠ¡ï¼Œå®ƒéœ€è¦ä¸“é—¨çš„å·¥ä½œã€‚é€šå¸¸æ¥è®²ï¼Œå¯ä»¥æŠŠä»»åŠ¡åˆ†æˆä¸¤æ­¥ï¼š\n\nä½¿ç”¨æ•°æ®æºç»˜åˆ¶åœ°å›¾ï¼›\nä»ä¿¡æ¯æºæ·»åŠ å…ƒæ•°æ®åˆ°åœ°å›¾ä¸Šã€‚\n\nRè¯­è¨€å†…ç½®äº†åœ°å›¾åŒ…ï¼Œè™½ç„¶ä¸æ˜¯æœ€æ–°çš„ï¼Œä½†æ˜¯ä¸€ä¸ªå¥½çš„èµ·ç‚¹ã€‚è¿™é‡Œä»ä¸­æå–å¯†æ­‡æ ¹å·çš„å¿ç•Œï¼š\n\nlibrary(tidyverse) # ç”¨äºæ•°æ®å¤„ç†\nmi_counties <- map_data(\"county\", \"michigan\") %>% \n  select(lon = long, lat, group, id = subregion)\nhead(mi_counties)\n#>     lon  lat group     id\n#> 1 -83.9 44.9     1 alcona\n#> 2 -83.4 44.9     1 alcona\n#> 3 -83.4 44.9     1 alcona\n#> 4 -83.3 44.8     1 alcona\n#> 5 -83.3 44.8     1 alcona\n#> 6 -83.3 44.8     1 alcona\n\nåˆ©ç”¨æ•£ç‚¹å›¾å¯ä»¥çœ‹åˆ°æ•°æ®é›†ä¸­æ¯ä¸ªå¿çš„è§’è½ï¼Œé€šè¿‡geom_polygon()å°†æ•£ç‚¹å›¾ç»˜åˆ¶æˆåœ°å›¾ï¼š\n\nggplot(mi_counties, aes(lon, lat)) +\n  geom_point(size = .25, show.legend = FALSE) +\n  coord_quickmap()\n\nggplot(mi_counties, aes(lon, lat, group = group)) +\n  geom_polygon(fill = \"white\", color = \"grey50\") +\n  coord_quickmap()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncoord_quickmap()è°ƒæ•´åæ ‡è½´ï¼Œä»¥ç¡®ä¿ç»åº¦å’Œçº¬åº¦åœ¨åŒä¸€æ¯”ä¾‹ä¸Šå‘ˆç°ã€‚ä½†åœ°ç†ç©ºé—´æ•°æ®å¾€å¾€éœ€è¦æ›´ç²¾å‡†çš„æ–¹æ³•ï¼Œå› æ­¤ggplot2æä¾›äº†geom_sf()å’Œcoord_sf()æ¥å¤„ç†ç®€å•ç‰¹å¾æ ¼å¼çš„ç©ºé—´æ•°æ®ã€‚\n\n2.4.1 Simple feature maps\nä¸Šè¿°æ–¹æ³•å…·æœ‰å±€é™æ€§ï¼Œæœ€å…¸å‹çš„æ˜¯ï¼šç°å®ä¸–ç•Œçš„åœ°å›¾ä¸æ˜¯ç®€å•åœ°æŒ‰ç…§â€ç»åº¦-çº¬åº¦â€çš„æ•°æ®æ ¼å¼ç»˜åˆ¶çš„ã€‚ åœ°å›¾çš„çŸ¢é‡æ•°æ®é€šå¸¸ä½¿ç”¨ç”±å¼€æ”¾åœ°ç†ç©ºé—´è”ç›Ÿåˆ¶å®šçš„â€ç®€å•ç‰¹å¾â€ï¼ˆsimple featuresï¼‰æ ‡å‡†è¿›è¡Œç¼–ç ã€‚ sfåŒ…(Pebesma 2018)ä¸ºå¤„ç†è¿™ç±»æ•°æ®æä¾›äº†ä¼˜è´¨çš„å·¥å…·é›†ï¼Œggplot2ä¸­çš„geom_sf()å’Œcoord_sf()å‡½æ•°å°±æ˜¯ä¸ºä¸sfåŒ…ä¸€èµ·å·¥ä½œè€Œè®¾è®¡çš„ã€‚\n\nlibrary(ozmaps) # æä¾›æ¾³å¤§åˆ©äºšçš„åœ°å›¾æ•°æ®\nlibrary(sf)\n#> Linking to GEOS 3.9.1, GDAL 3.4.3, PROJ 7.2.1; sf_use_s2() is TRUE\n\nozmap_states\n#> Simple feature collection with 9 features and 1 field\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 106 ymin: -43.6 xmax: 168 ymax: -9.23\n#> Geodetic CRS:  GDA94\n#> # A tibble: 9 Ã— 2\n#>   NAME                                                      geometry\n#> * <chr>                                           <MULTIPOLYGON [Â°]>\n#> 1 New South Wales              (((151 -35.1, 151 -35.1, 151 -35.1, â€¦\n#> 2 Victoria                     (((147 -38.7, 147 -38.7, 147 -38.7, â€¦\n#> 3 Queensland                   (((149 -20.3, 149 -20.4, 149 -20.4, â€¦\n#> 4 South Australia              (((137 -34.5, 137 -34.5, 137 -34.5, â€¦\n#> 5 Western Australia            (((126 -14, 126 -14, 126 -14, 126 -1â€¦\n#> 6 Tasmania                     (((148 -40.3, 148 -40.3, 148 -40.3, â€¦\n#> 7 Northern Territory           (((136 -13.8, 136 -13.8, 136 -13.8, â€¦\n#> 8 Australian Capital Territory (((149 -35.2, 149 -35.2, 149 -35.3, â€¦\n#> 9 Other Territories            (((168 -29.1, 168 -29, 168 -29, 168 â€¦\n\nsfæ•°æ®çš„ä¸€ä¸ªä¼˜åŠ¿ï¼Œåœ¨äºæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æ•°æ®çš„æ•´ä½“ç»“æ„ã€‚æ¾³å¤§åˆ©äºšç”±6ä¸ªå·å’Œä¸€äº›åœ°åŒºç»„æˆï¼Œå…±9ä¸ªåœ°ç†å•å…ƒï¼Œå› æ­¤æ•°æ®ä¸­æœ‰9è¡Œã€‚geometryåˆ—çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¤šè¾¹å½¢å¯¹è±¡ï¼ŒæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå¤šè¾¹å½¢é¡¶ç‚¹ï¼Œæ ‡ç¤ºç€ä¸€ä¸ªåœ°åŒºçš„è¾¹ç•Œã€‚\nå¯¹äºè¿™ç§æ ¼å¼çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨geom_sf()å’Œcoord_sf()ç»˜åˆ¶ä¸€å¼ å¯ç”¨çš„åœ°å›¾è€Œä¸éœ€è¦åˆ¶å®šä»»ä½•å‚æ•°ï¼Œç”šè‡³ä¸éœ€è¦æ˜ç¡®ç¾å­¦ã€‚\n\nggplot(ozmap_states) +\n  geom_sf() +\n  coord_sf()\n\n\n\n\n\n\n\ngeom_sf()ä½¿ç”¨ggplot2ä¸­å…¶ä»–åœ°æ–¹æ²¡æœ‰ä½¿ç”¨çš„geometryç¾å­¦ï¼Œè¿™ç§ç¾å­¦å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼ä¹‹ä¸€æ¥åˆ¶å®šã€‚\n\nç”¨æˆ·æ— éœ€ä»»ä½•æ“ä½œï¼Œgeom_sf()è‡ªåŠ¨å°†åä¸ºgeometryçš„åˆ—æ˜ å°„åˆ°åœ°å›¾ä¸­ã€‚\nå¦‚æœæ•°æ®æ˜¯ä¸€ä¸ªsfå¯¹è±¡ï¼Œgeom_sf()è‡ªåŠ¨æ£€æµ‹geometryæ ¼å¼çš„åˆ—ï¼Œå³ä½¿è¯¥åˆ—åä¸ä¸ºgeometryã€‚\nä½¿ç”¨aes(geometry = my_column)æ‰‹åŠ¨æŒ‡å®šæ˜ å°„ï¼Œåœ¨æ•°æ®ä¸­æœ‰å¤šä¸ªgeometryæ ¼å¼çš„åˆ—æ—¶å¾ˆæœ‰ç”¨ã€‚\n\nggplot2æ”¯æŒå¤šå±‚geom_sf()å åŠ ã€‚ä½¿ç”¨rmapshaperåŒ…(Teucher and Russell 2022)ç®€åŒ–è¾¹ç•Œï¼Œä»¥å‡å°‘æ¸²æŸ“ç»˜å›¾çš„æ—¶é—´ã€‚å½“åŸå§‹æ•°æ®é›†ï¼ˆæœ¬ä¾‹ä¸­ä¸ºabs_cedï¼‰çš„å­˜å‚¨åˆ†è¾¨ç‡é«˜äºç»˜å›¾è¦æ±‚æ—¶ï¼Œè¿™é€šå¸¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚\n\noz_states <- ozmap_states %>% filter(NAME != \"Other Territories\")\noz_votes <- rmapshaper::ms_simplify(abs_ced)\n#> Registered S3 method overwritten by 'geojsonlint':\n#>   method         from \n#>   print.location dplyr\n\nggplot() +\n  geom_sf(data = oz_states, mapping = aes(fill = NAME), show.legend = FALSE) +\n  geom_sf(data = oz_votes, fill = NA) +\n  coord_sf()\n\n\n\n\n\n\n\nå›¾ä¸Šæ·»åŠ æ ‡ç­¾ï¼š\n\nsydney_map <- abs_ced %>% filter(NAME %in% c(\n  \"Sydney\", \"Wentworth\", \"Warringah\", \"Kingsford Smith\", \"Grayndler\", \"Lowe\", \n  \"North Sydney\", \"Barton\", \"Bradfield\", \"Banks\", \"Blaxland\", \"Reid\", \n  \"Watson\", \"Fowler\", \"Werriwa\", \"Prospect\", \"Parramatta\", \"Bennelong\", \n  \"Mackellar\", \"Greenway\", \"Mitchell\", \"Chifley\", \"McMahon\"\n))\n\nggplot(sydney_map) +\n  geom_sf(aes(fill = NAME), show.legend = FALSE) +\n  coord_sf(xlim = c(150.97, 151.3), ylim = c(-33.98, -33.79)) +\n  geom_sf_label(aes(label = NAME), label.padding = unit(1, \"mm\"))\n#> Warning in st_point_on_surface.sfc(sf::st_zm(x)):\n#> st_point_on_surface may not give correct results for longitude/\n#> latitude data\n\n\n\n\n\n\n\n\n\n\n\n\n\nWarning\n\n\n\ngeom_sf_label()å‡½æ•°å†…éƒ¨ä½¿ç”¨sfåŒ…ä¸­çš„å‡½æ•°st_point_on_surface()æ¥æ”¾ç½®æ ‡ç­¾ï¼Œå‡ºç°ä¸Šè¿°è­¦å‘Šæ˜¯å› ä¸ºsfç”¨äºè®¡ç®—å‡ ä½•é‡ï¼ˆä¾‹å¦‚ä¸­å¿ƒç‚¹ã€å†…éƒ¨ç‚¹ï¼‰çš„å¤§å¤šæ•°ç®—æ³•éƒ½æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªå‡è®¾ï¼šç‚¹ä½äºä¸€ä¸ªå¹³å¦çš„äºŒç»´è¡¨é¢ä¸Šï¼Œå¹¶ä»¥ç¬›å¡å°”åæ ‡ä½œä¸ºå‚æ•°ã€‚è¿™ç§å‡è®¾å¹¶ä¸ä¸¥æ ¼ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚ï¼Œé è¿‘ä¸¤æçš„åœ°åŒºï¼‰ï¼Œä»¥è¿™ç§æ–¹å¼å¤„ç†ç»åº¦å’Œçº¬åº¦çš„è®¡ç®—ä¼šå¾—åˆ°é”™è¯¯çš„ç­”æ¡ˆã€‚å› æ­¤ï¼Œsfè½¯ä»¶åŒ…åœ¨ä¾èµ–è¿™ç§è¿‘ä¼¼æ–¹å¼è¿›è¡Œè®¡ç®—æ—¶å°†äº§ç”Ÿè­¦å‘Šã€‚\n\n\næ·»åŠ å…¶ä»–å›¾å±‚ï¼š\n\noz_capitals <- tibble::tribble( \n  ~city,           ~lat,     ~lon,\n  \"Sydney\",    -33.8688, 151.2093,  \n  \"Melbourne\", -37.8136, 144.9631, \n  \"Brisbane\",  -27.4698, 153.0251, \n  \"Adelaide\",  -34.9285, 138.6007, \n  \"Perth\",     -31.9505, 115.8605, \n  \"Hobart\",    -42.8821, 147.3272, \n  \"Canberra\",  -35.2809, 149.1300, \n  \"Darwin\",    -12.4634, 130.8456, \n)\n\nggplot() + \n  geom_sf(data = oz_votes) + \n  geom_sf(data = oz_states, colour = \"black\", fill = NA) + \n  geom_point(data = oz_capitals, mapping = aes(x = lon, y = lat), colour = \"red\") + \n  coord_sf()\n\n\n\n\n\n\n\n\n2.4.2 åœ°å›¾æŠ•å½±\nå¦‚æœå…³æ³¨åœ°å›¾çš„å‡†ç¡®æ€§ï¼Œåˆ©ç”¨ç»çº¬åº¦åœ¨ç¬›å¡å°”å¹³é¢ä¸Šè¿›è¡Œç»˜åˆ¶å¹¶éæœ€ä½³åŠæ³•ï¼Œè‡³å°‘å­˜åœ¨ä¸¤ä¸ªåŸºæœ¬é—®é¢˜ï¼š\n\nåœ°çƒæ—¢ä¸æ˜¯ä¸€ä¸ªå¹³é¢ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„çƒä½“ã€‚å…³äºåœ°çƒå½¢çŠ¶çš„ä¸€ç³»åˆ—å‡è®¾è¢«ç§°ä¸ºå¤§åœ°åŸºå‡†ï¼Œè™½ç„¶å®ƒå¯¹æŸäº›æ•°æ®çš„å¯è§†åŒ–å¯èƒ½å¹¶ä¸é‡è¦ï¼Œä½†å¯¹å…¶ä»–æ•°æ®æ¥è¯´ï¼Œå®ƒæ˜¯è‡³å…³é‡è¦çš„ã€‚æœ‰å‡ ç§ä¸åŒçš„é€‰æ‹©å¯ä»¥è€ƒè™‘ï¼šå¦‚æœé‡ç‚¹æ˜¯åŒ—ç¾ï¼Œâ€œåŒ—ç¾åŸºå‡†â€ï¼ˆNAD83ï¼‰æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼›å¦‚æœè§†è§’æ˜¯å…¨çƒï¼Œâ€œä¸–ç•Œå¤§åœ°æµ‹é‡ç³»ç»Ÿâ€ï¼ˆWGS84ï¼‰å¯èƒ½æ›´å¥½ã€‚\nåœ°å›¾çš„å½¢çŠ¶ã€‚åœ°çƒè¿‘ä¼¼æ¤­åœ†ä½“ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç©ºé—´æ•°æ®éœ€è¦ç»˜åˆ¶åœ¨ä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šã€‚ä¸å¯èƒ½åœ¨ä¸å‘ç”Ÿæ‰­æ›²æˆ–åˆ‡å‰²çš„æƒ…å†µä¸‹æŠŠæ¤­åœ†ä½“çš„è¡¨é¢æ˜ å°„åˆ°ä¸€ä¸ªå¹³é¢ä¸Šï¼Œå› æ­¤å¿…é¡»å¯¹æ‰­æ›²ä½œå‡ºé€‰æ‹©ã€‚è¿™å°±æ˜¯åœ°å›¾æŠ•å½±çš„å·¥ä½œã€‚ åœ°å›¾æŠ•å½±é€šå¸¸æŒ‰ç…§å®ƒä»¬ä¿ç•™çš„å‡ ä½•å±æ€§æ¥åˆ†ç±»ï¼Œä¾‹å¦‚ï¼š\n\n\n\né¢ç§¯ä¿æŠ¤å‹æŠ•å½±ç¡®ä¿åœ°çƒä¸Šé¢ç§¯ç›¸ç­‰çš„åŒºåŸŸåœ¨åœ°å›¾ä¸Šçš„ç»˜åˆ¶é¢ç§¯ç›¸ç­‰ã€‚\n\nå½¢çŠ¶ä¿æŠ¤å‹ï¼ˆä¿å½¢æˆ–ä¿è§’ï¼‰æŠ•å½±ç¡®ä¿åŒºåŸŸçš„å±€éƒ¨å½¢çŠ¶å¾—åˆ°ä¿ç•™ã€‚\n\nä»»ä½•æŠ•å½±éƒ½æ— æ³•åšåˆ°æ—¢ä¿å½¢åˆä¿é¢ç§¯ï¼Œsfå…è®¸æˆ‘ä»¬å¯ä»¥æŒ‡å®šæƒ³ä½¿ç”¨çš„åœ°å›¾æŠ•å½±ã€‚å…³äºåœ°å›¾æŠ•å½±çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§Geocomputation with Rã€‚\nç»¼ä¸Šï¼Œå¤§åœ°åŸºå‡†ï¼ˆå¦‚WGS84ï¼‰ã€åœ°å›¾æŠ•å½±ç±»å‹ï¼ˆå¦‚å¢¨å¡æ‰˜ï¼‰å’ŒæŠ•å½±å‚æ•°ï¼ˆå¦‚åŸç‚¹ä½ç½®ï¼‰å…±åŒæŒ‡å®šäº†ä¸€ä¸ªåæ ‡å‚è€ƒç³»ç»Ÿï¼ˆcoordinate reference systemï¼ŒCRSï¼‰ã€‚è¿™æ˜¯ä¸€å¥—ç”¨äºå°†ç»çº¬åº¦ä¿¡æ¯è½¬æ¢ä¸ºäºŒç»´åœ°å›¾çš„å®Œæ•´å‡è®¾ã€‚ä¸€ä¸ªsfå¯¹è±¡é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªé»˜è®¤çš„CRSï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\nst_crs(oz_votes)\n#> Coordinate Reference System:\n#>   User input: EPSG:4283 \n#>   wkt:\n#> GEOGCRS[\"GDA94\",\n#>     DATUM[\"Geocentric Datum of Australia 1994\",\n#>         ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n#>             LENGTHUNIT[\"metre\",1]]],\n#>     PRIMEM[\"Greenwich\",0,\n#>         ANGLEUNIT[\"degree\",0.0174532925199433]],\n#>     CS[ellipsoidal,2],\n#>         AXIS[\"geodetic latitude (Lat)\",north,\n#>             ORDER[1],\n#>             ANGLEUNIT[\"degree\",0.0174532925199433]],\n#>         AXIS[\"geodetic longitude (Lon)\",east,\n#>             ORDER[2],\n#>             ANGLEUNIT[\"degree\",0.0174532925199433]],\n#>     USAGE[\n#>         SCOPE[\"Horizontal component of 3D system.\"],\n#>         AREA[\"Australia including Lord Howe Island, Macquarie Islands, Ashmore and Cartier Islands, Christmas Island, Cocos (Keeling) Islands, Norfolk Island. All onshore and offshore.\"],\n#>         BBOX[-60.56,93.41,-8.47,173.35]],\n#>     ID[\"EPSG\",4283]]\n\nè¿™äº›è¾“å‡ºå¤§å¤šå¯¹åº”äºä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„æ–‡æœ¬ï¼ˆwell-know textï¼ŒWKTï¼‰å­—ç¬¦ä¸²ï¼Œå®ƒè¯¦ç»†æè¿°äº†CRSã€‚sfå†…éƒ¨ä½¿ç”¨è¿™ç§å†—é•¿çš„WKTè¡¨ç¤ºæ³•ï¼Œä½†æ˜¯æœ‰å‡ ç§æ–¹æ³•å¯ä»¥æä¾›sfç†è§£çš„ç”¨æˆ·è¾“å…¥ã€‚å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯ä»¥EPSGä»£ç çš„å½¢å¼æä¾›æ•°å­—è¾“å…¥ã€‚oz_votesæ•°æ®ä¸­çš„é»˜è®¤CRSä¸EPSGä»£ç 4283ç›¸å¯¹åº”ã€‚\n\nst_crs(oz_votes) == st_crs(4283)\n#> [1] TRUE\n\nåœ¨ggplot2ä¸­ï¼Œcoord_sf()æ§åˆ¶CRSï¼Œä»¥ç¡®ä¿æ¯ä¸€å±‚éƒ½ä½¿ç”¨ç›¸åŒçš„æŠ•å½±ã€‚sfæ•°æ®é€šå¸¸ä¼šæä¾›ä¸€ä¸ªåˆç†çš„CRSé€‰æ‹©ï¼Œcoord_sf()é»˜è®¤ä½¿ç”¨æ•°æ®geometryåˆ—ç›¸å…³çš„CRSã€‚å½“éœ€è¦æŒ‡å®šCRSæ—¶ï¼Œå¯ä»¥é€šè¿‡å‘st_crs()ä¼ é€’crså‚æ•°ï¼š\n\nggplot(oz_votes) + geom_sf()\nggplot(oz_states) + geom_sf() + coord_sf(crs = st_crs(3112))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.4.3 Raster maps\nç»˜åˆ¶åœ°ç†ç©ºé—´ä¿¡æ¯çš„ç¬¬äºŒç§æ–¹å¼æ˜¯ä¾é æ …æ ¼æ•°æ®ï¼ˆraster dataï¼‰ã€‚ä¸sfæ•°æ®ä¸åŒï¼Œæ …æ ¼æ•°æ®ä¸­ï¼Œåœ°ç†å®ä½“æ˜¯ä»¥ä¸€ç»„çº¿ã€ç‚¹å’Œå¤šè¾¹å½¢çš„å½¢å¼æ¥æŒ‡å®šçš„ï¼Œè€Œæ …æ ¼åˆ™æ˜¯ä»¥å›¾åƒçš„å½¢å¼å‡ºç°ã€‚åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œå…‰æ …æ•°æ®å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰è®¸å¤šä¸åŒçš„å›¾åƒæ ¼å¼ä½å›¾æ–‡ä»¶ã€‚å…·ä½“åˆ°åœ°ç†ç©ºé—´æ–¹é¢ï¼Œæœ‰ä¸€äº›å›¾åƒæ ¼å¼åŒ…æ‹¬å…ƒæ•°æ®ï¼ˆå¦‚å¤§åœ°æµ‹é‡åŸºå‡†ã€åæ ‡å‚è€ƒç³»ç»Ÿï¼‰ï¼Œå¯ç”¨äºå°†å›¾åƒä¿¡æ¯æ˜ å°„åˆ°åœ°çƒè¡¨é¢ã€‚\nåœ¨GDALï¼ˆåœ°ç†ç©ºé—´æ•°æ®æŠ½è±¡åº“ï¼‰çš„å¸®åŠ©ä¸‹ï¼Œå¤§å¤šæ•°æ ¼å¼å¯ä»¥å¾ˆå®¹æ˜“åœ°è¯»å…¥Rã€‚ä¾‹å¦‚ï¼ŒsfåŒ…ä¸­çš„sf::gdal_read()å‡½æ•°æä¾›äº†ä»Rä¸­è®¿é—®GDALçš„åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œå¾ˆå°‘éœ€è¦ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸ºè¿˜æœ‰å…¶ä»–é«˜çº§å‡½æ•°å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æƒ³ç»˜åˆ¶æ¾³å¤§åˆ©äºšæ°”è±¡å±€ï¼ˆBOMï¼‰åœ¨å…¶FTPæœåŠ¡å™¨ä¸Šå…¬å¼€æä¾›çš„å«æ˜Ÿå›¾åƒã€‚bomrangåŒ…(Sparks et al. 2017)æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æœåŠ¡å™¨æ¥å£ï¼ŒåŒ…æ‹¬ä¸€ä¸ªè¿”å›æ–‡ä»¶åå‘é‡çš„get_available_imagery()å‡½æ•°å’Œä¸€ä¸ªä¸‹è½½æ–‡ä»¶å¹¶ç›´æ¥å¯¼å…¥Rä¸­çš„get_satellite_imagery()å‡½æ•°ã€‚\nè¿™é‡Œä½¿ç”¨æ›´çµæ´»çš„æ–¹å¼ï¼Œå¯ä»¥é€‚ç”¨ä»»ä½•FTPæœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨download.file()å‡½æ•°ï¼š\n\n# list of all file names with time stamp 2022-08-04 21:00 GMT \n# (BOM images are retained for 24 hours, so this will return an\n# empty vector if you run this code without editing the time stamp)\nfiles <- bomrang::get_available_imagery() %>% \n  str_subset(\"202208042100\")\n\nwalk2(\n  .x = paste0(\"ftp://ftp.bom.gov.au/anon/gen/gms/\", files),\n  .y = file.path(\"raster\", files),\n  .f = ~ download.file(url = .x, destfile = .y)\n)\n\næ‰€æœ‰14ä¸ªæ–‡ä»¶2éƒ½æ˜¯ç”±æ—¥æœ¬æ°”è±¡å…è¿è¥çš„Himawari-8åœ°çƒé™æ­¢å«æ˜Ÿæ‹æ‘„çš„å›¾åƒæ„å»ºçš„ï¼Œå¹¶åœ¨13ä¸ªä¸åŒçš„æ³¢æ®µæ‹æ‘„å›¾åƒã€‚æ¾³å¤§åˆ©äºšBOMå‘å¸ƒçš„å›¾åƒåŒ…æ‹¬å¯è§å…‰è°±ï¼ˆé¢‘é“3ï¼‰å’Œçº¢å¤–å…‰è°±ï¼ˆé¢‘é“13ï¼‰çš„æ•°æ®ã€‚\nä¸ºäº†å°†å¯è§å›¾ç‰‡å¯¼å…¥Rï¼Œä½¿ç”¨starsåŒ…(Pebesma 2022)å°†å…¶å¯¼å…¥ä¸ºstarså¯¹è±¡ï¼š\n\nimg_vis  <- file.path(\"raster\", \"IDE00422.202208042100.tif\")\nimg_inf <- file.path(\"raster\", \"IDE00421.202208042100.tif\")\n\nlibrary(stars)\n#> Loading required package: abind\nsat_vis <- read_stars(img_vis, RasterIO = list(nBufXSize = 600, nBufYSize = 600))\nsat_inf <- read_stars(img_inf, RasterIO = list(nBufXSize = 600, nBufYSize = 600))\n\nRasterIOå‚æ•°ç”¨æ¥å‘GDALä¼ é€’ä¸€åˆ—ä½çº§å‚æ•°ï¼Œä½¿ç”¨äº†nBufXSizeå’ŒnBufYSizeæ¥ç¡®ä¿Rä»¥ä½åˆ†è¾¨ç‡è¯»å–æ•°æ®ï¼ˆä½œä¸º600x600åƒç´ çš„å›¾åƒï¼‰ã€‚\n\nsat_vis\n#> stars object with 3 dimensions and 1 attribute\n#> attribute(s), summary of first 1e+05 cells:\n#>                            Min. 1st Qu. Median Mean 3rd Qu. Max.\n#> IDE00422.202208042100.tif     0       0      0 37.9      52  255\n#> dimension(s):\n#>      from  to   offset    delta                  refsys point\n#> x       1 600 -5500000  18333.3 Geostationary_Satellite FALSE\n#> y       1 600  5500000 -18333.3 Geostationary_Satellite FALSE\n#> band    1   3       NA       NA                      NA    NA\n#>      values x/y\n#> x      NULL [x]\n#> y      NULL [y]\n#> band   NULL\n\næ³¨æ„ï¼Œç©ºé—´æ•°æ®ä¹Ÿä¸ä¸€ä¸ªåæ ‡å‚è€ƒç³»ç»Ÿç›¸å…³è”ï¼ˆåœ¨è¾“å‡ºä¸­è¢«ç§°ä¸º â€œrefsysâ€ï¼‰ã€‚\nåˆ©ç”¨starsåŒ…æä¾›çš„geom_stars()å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ggplot2è¿›è¡Œç»˜å›¾ï¼š\n\nggplot() +\n  geom_stars(data = sat_vis) +\n  coord_equal()\n\n\n\n\n\n\n\ngeom_stars()å‡½æ•°è¦æ±‚æ•°æ®æ˜¯starså¯¹è±¡ï¼Œå¹¶å°†æ …æ ¼æ•°æ®æ˜ å°„åˆ°å¡«å……ï¼ˆfillï¼‰ç¾å­¦ã€‚å› æ­¤ï¼Œä¸Šé¢çš„å«æ˜Ÿå›¾åƒä¸­çš„è“è‰²é˜´å½±æ˜¯ç”±ggplot2çš„æ¯”ä¾‹å†³å®šçš„ï¼Œè€Œä¸æ˜¯å›¾åƒæœ¬èº«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡sat_visåŒ…å«ä¸‰ä¸ªæ³¢æ®µï¼Œä½†ä¸Šé¢çš„ç»˜å›¾åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ³¢æ®µï¼ŒåŸå§‹æ•°æ®å€¼ï¼ˆèŒƒå›´ä»0åˆ°255ï¼‰è¢«æ˜ å°„åˆ°ggplot2ç”¨äºè¿ç»­æ•°æ®çš„é»˜è®¤è“è‰²è°ƒè‰²æ¿ä¸Šã€‚ä¸ºäº†çœ‹åˆ°å›¾åƒæ–‡ä»¶çš„çœŸå®é¢è²Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨facet_wrap()åˆ†ç¦»è¿™äº›æ³¢æ®µï¼š\n\nggplot() +\n  geom_stars(data = sat_vis, show.legend = FALSE) +\n  facet_wrap(vars(band)) +\n  coord_equal() +\n  scale_fill_gradient(low = \"black\", high = \"white\")\n\n\n\n\n\n\n\nåªæ˜¾ç¤ºåŸå§‹å›¾åƒä¸æ˜“å¼„æ¸…æ¥šç›¸å…³çš„é™†åœ°åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†å«æ˜Ÿæ•°æ®ä¸oz_statesçŸ¢é‡åœ°å›¾é‡å ï¼Œä»¥æ˜¾ç¤ºæ¾³å¤§åˆ©äºšæ”¿æ²»å®ä½“çš„è½®å»“ã€‚è¿™æ ·åšéœ€æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªæ•°æ®æºå…·æœ‰ä¸åŒçš„åæ ‡å‚è€ƒç³»ç»Ÿã€‚ä¸ºäº†æ­£ç¡®æŠ•å½±oz_statesçš„æ•°æ®ï¼Œéœ€ä½¿ç”¨sfåŒ…ä¸­çš„st_transform()å‡½æ•°å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ã€‚ä¸‹é¢çš„ä»£ç å°†ä»sat_visæ …æ ¼å¯¹è±¡ä¸­æå–CRSï¼Œå¹¶åº”ç”¨äºoz_statesï¼Œè€Œåè¿›è¡Œå¯è§†åŒ–ï¼š\n\noz_states <- st_transform(oz_states, crs = st_crs(sat_vis))\n\nggplot() +\n  geom_stars(data = sat_vis, show.legend = FALSE) +\n  geom_sf(data = oz_states, fill = NA, color = \"white\") +\n  coord_sf() +\n  theme_void() +\n  scale_fill_gradient(low = \"black\", high = \"white\")\n\n\n\n\n\n\n\nå¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªæ‹æ‘„æ—¶é—´ï¼Œæ¾³å¤§åˆ©äºšå³å°†æ—¥å‡ºã€‚\nå¦‚ä½•åœ¨ä¸Šé¢ç»˜åˆ¶æ›´å¤šçš„å¸¸è§„æ•°æ®å‘¢ï¼Ÿä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯æ ¹æ®åŒ…å«ç»çº¬åº¦çš„oz_capitalsæ•°æ®æ¡†æ¥ç»˜åˆ¶æ¾³å¤§åˆ©äºšé¦–éƒ½çš„ä½ç½®ã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›æ•°æ®æ²¡æœ‰ä¸CRSç›¸å…³è”ï¼Œå¹¶ä¸”ä¸sat_visä¸­çš„æ …æ ¼æ•°æ®çš„æ¯”ä¾‹ä¸ä¸€æ ·ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®ä¹Ÿéœ€è¦è¿›è¡Œè½¬æ¢ã€‚ä¸ºæ­¤ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨st_as_sf()ä»oz_capitalsæ•°æ®ä¸­åˆ›å»ºsfå¯¹è±¡ï¼š\n\ncities <- oz_capitals %>% \n  st_as_sf(coords = c(\"lon\", \"lat\"), crs = 4326, remove = FALSE)\n\nè¿™ä¸ªæŠ•å½±æ˜¯ä½¿ç”¨EPSGä»£ç 4326è®¾ç½®çš„ï¼Œè¿™æ˜¯ä½¿ç”¨ç»çº¬åº¦å€¼ä½œä¸ºåæ ‡å¹¶ä¾é WGS84åŸºå‡†çš„æ¤­åœ†å½¢æŠ•å½±ã€‚è€Œåå¯ä»¥å°†ç»çº¬åº¦å‡ ä½•åæ ‡è½¬æ¢ä¸ºä¸sat_visæ•°æ®çš„å‡ ä½•å½¢çŠ¶ç›¸åŒ¹é…ã€‚\n\ncities <- st_transform(cities, st_crs(sat_vis))\n\nggplot() +\n  geom_stars(data = sat_vis, show.legend = FALSE) +\n  geom_sf(data = oz_states, fill = NA, color = \"white\") +\n  geom_sf(data = cities, color = \"red\") +\n  coord_sf() +\n  theme_void() +\n  scale_fill_gradient(low = \"black\", high = \"white\")\n\n\n\n\n\n\n\nå¦‚æœæœ‰è‡ªå·±çš„å½¢çŠ¶æ–‡ä»¶ï¼ˆ.shpï¼‰ï¼Œå¯ä»¥ç”¨sf::read_sf()æŠŠå®ƒä»¬åŠ è½½åˆ°Rä¸­ã€‚"
  },
  {
    "objectID": "vis-ggplot2-layers.html#ç½‘ç»œå›¾",
    "href": "vis-ggplot2-layers.html#ç½‘ç»œå›¾",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.5 ç½‘ç»œå›¾",
    "text": "2.5 ç½‘ç»œå›¾\nç½‘ç»œåœ¨å¯è§†åŒ–ä¸­å æ®äº†ä¸€å¸­ä¹‹åœ°ï¼Œå’Œåœ°å›¾ã€ç©ºé—´æ•°æ®ä¸€æ ·ï¼Œç½‘ç»œå…·æœ‰ç‰¹å®šçš„æ•°æ®ç»“æ„å’Œå¯è§†åŒ–èŒƒå¼ï¼Œggplot2å¹¶ä¸ç›´æ¥æ”¯æŒç½‘ç»œå›¾ï¼Œæ¥ä¸‹æ¥å°†ä½¿ç”¨ggraphåŒ…(Pedersen 2021b)è¿›è¡Œç½‘ç»œçš„å¯è§†åŒ–ã€‚\n\n2.5.1 ç½‘ç»œæ•°æ®\nç½‘ç»œæ•°æ®å¯ä»¥ç¼–ç ä¸ºä¸¤ä¸ªç›¸äº’å…³è”çš„æ•°æ®å¸§ï¼Œåˆ†åˆ«ç¼–ç èŠ‚ç‚¹å’Œè¾¹ï¼Œè¿™å°±æ˜¯tidygraphåŒ…(Pedersen 2022)ä½¿ç”¨çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ggraphçš„åŸºç¡€æ•°æ®å¤„ç†åŒ…ã€‚\n\nlibrary(tidygraph)\nlibrary(ggraph)\n\ngraph <- play_erdos_renyi(n = 10, p = .2) %>% \n  activate(nodes) %>% \n  mutate(class = sample(letters[1:4], n(), replace = TRUE)) %>% \n  activate(edges) %>% \n  arrange(.N()$class[from])\ngraph\n#> # A tbl_graph: 10 nodes and 20 edges\n#> #\n#> # A directed simple graph with 1 component\n#> #\n#> # Edge Data: 20 Ã— 2 (active)\n#>    from    to\n#>   <int> <int>\n#> 1     5     1\n#> 2     2     3\n#> 3     2     8\n#> 4     5     8\n#> 5     5     9\n#> 6     1     2\n#> # â€¦ with 14 more rows\n#> #\n#> # Node Data: 10 Ã— 1\n#>   class\n#>   <chr>\n#> 1 b    \n#> 2 a    \n#> 3 d    \n#> # â€¦ with 7 more rows\n\nä¸€äº›æ–°å‡½æ•°ï¼šactivate()æŒ‡å®šåœ¨ç½‘ç»œçš„å“ªä¸ªéƒ¨åˆ†å·¥ä½œï¼ˆèŠ‚ç‚¹æˆ–è€…è¾¹ï¼‰ï¼›å³ä½¿åœ¨å¤„ç†è¾¹çš„æ—¶å€™ï¼Œ.N()ä¹Ÿå¯ä»¥è®¿é—®å½“å‰å›¾å½¢çš„èŠ‚ç‚¹æ•°æ®ï¼ˆä¸ä¹‹å¯¹åº”çš„.E()å‡½æ•°è®¿é—®è¾¹çš„æ•°æ®ï¼Œä»¥åŠ.G()è®¿é—®æ•´ä¸ªå›¾å½¢ï¼‰ã€‚\ntidygraphåŒ…çš„as_tbl_graph()å¯ä»¥å°†å¤§éƒ¨åˆ†ä¸åŒå½¢å¼çš„ç½‘ç»œæ•°æ®è¿›è¡Œè½¬æ¢:\n\nhead(highschool)\n#>   from to year\n#> 1    1 14 1957\n#> 2    1 15 1957\n#> 3    1 21 1957\n#> 4    1 54 1957\n#> 5    1 55 1957\n#> 6    2 21 1957\n\nhs_graph <- as_tbl_graph(highschool, directed = FALSE) # ä¸å¸¦æ–¹å‘\nhs_graph\n#> # A tbl_graph: 70 nodes and 506 edges\n#> #\n#> # An undirected multigraph with 1 component\n#> #\n#> # Node Data: 70 Ã— 1 (active)\n#>   name \n#>   <chr>\n#> 1 1    \n#> 2 2    \n#> 3 3    \n#> 4 4    \n#> 5 5    \n#> 6 6    \n#> # â€¦ with 64 more rows\n#> #\n#> # Edge Data: 506 Ã— 3\n#>    from    to  year\n#>   <int> <int> <dbl>\n#> 1     1    13  1957\n#> 2     1    14  1957\n#> 3     1    20  1957\n#> # â€¦ with 503 more rows\n\n\nluv_clust <- hclust(dist(luv_colours[, 1:3]))\nluv_graph <- as_tbl_graph(luv_clust)\nluv_graph\n#> # A tbl_graph: 1313 nodes and 1312 edges\n#> #\n#> # A rooted tree\n#> #\n#> # Node Data: 1,313 Ã— 4 (active)\n#>   height leaf  label members\n#>    <dbl> <lgl> <chr>   <int>\n#> 1     0  TRUE  \"101\"       1\n#> 2     0  TRUE  \"427\"       1\n#> 3   778. FALSE \"\"          2\n#> 4     0  TRUE  \"571\"       1\n#> 5     0  TRUE  \"426\"       1\n#> 6     0  TRUE  \"424\"       1\n#> # â€¦ with 1,307 more rows\n#> #\n#> # Edge Data: 1,312 Ã— 2\n#>    from    to\n#>   <int> <int>\n#> 1     3     1\n#> 2     3     2\n#> 3     8     6\n#> # â€¦ with 1,309 more rows\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œtidygraphåœ¨è½¬æ¢æ—¶è‡ªåŠ¨æ·»åŠ äº†é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œhighschoolæ•°æ®ä¸­çš„yearåˆ—ï¼Œä»¥åŠåˆ†å±‚èšç±»luv_clustä¸­çš„labelå’ŒleafèŠ‚ç‚¹ã€‚\n\n# ä¸­å¿ƒåº¦è®¡ç®—\ngraph %>% \n  activate(nodes) %>% \n  mutate(centrality = centrality_pagerank()) %>% \n  arrange(desc(centrality))\n#> # A tbl_graph: 10 nodes and 20 edges\n#> #\n#> # A directed simple graph with 1 component\n#> #\n#> # Node Data: 10 Ã— 2 (active)\n#>   class centrality\n#>   <chr>      <dbl>\n#> 1 b         0.169 \n#> 2 d         0.158 \n#> 3 a         0.155 \n#> 4 c         0.125 \n#> 5 d         0.123 \n#> 6 c         0.0870\n#> # â€¦ with 4 more rows\n#> #\n#> # Edge Data: 20 Ã— 2\n#>    from    to\n#>   <int> <int>\n#> 1     8     1\n#> 2     3     2\n#> 3     3     4\n#> # â€¦ with 17 more rows\n\ntidygraphæ”¯æŒä¸€ç³»åˆ—ä¸°å¯Œçš„ç®—æ³•ï¼Œæ¯”å¦‚ä¸­å¿ƒåº¦è®¡ç®—ï¼ˆå“ªä¸ªèŠ‚ç‚¹æœ€ä¸­å¿ƒï¼‰ã€æ’åºï¼ˆå¯¹èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œä½¿èŠ‚ç‚¹ä½äºä¸ä¹‹ç›¸è¿çš„èŠ‚ç‚¹é™„è¿‘ï¼‰ã€åˆ†ç»„ï¼ˆåœ¨ç½‘ç»œå†…å¯»æ‰¾ç¾¤ç»„ï¼‰ç­‰ï¼Œå…·ä½“è§è¿™é‡Œã€‚\nç½‘ç»œå›¾æ›´å…³æ³¨æ‹“æ‰‘ç»“æ„è€Œä¸æ˜¯ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬é‡‡ç”¨å¸ƒå±€ï¼ˆLayoutsï¼‰çš„æ¦‚å¿µæ¥æ˜¾ç¤ºç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚å¸ƒå±€æ˜¯åˆ©ç”¨ç½‘ç»œç»“æ„æ¥è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„xå’Œyå€¼ï¼ˆé€šå¸¸æ˜¯ä»»æ„çš„ï¼‰çš„ç®—æ³•ï¼Œæœ€ç»ˆç”¨äºå¯è§†åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ç»˜åˆ¶è¡¨æ ¼æ•°æ®æ—¶ï¼Œxå’Œyçš„ç¾å­¦å‡ ä¹æ€»æ˜¯è¢«æ•°æ®ä¸­çš„ç°æœ‰å˜é‡ï¼ˆæˆ–ç°æœ‰æ•°æ®çš„ç»Ÿè®¡è½¬æ¢ï¼‰æ˜ å°„ï¼Œè€Œåœ¨ç»˜åˆ¶ç½‘ç»œæ•°æ®æ—¶ï¼Œxå’Œyè¢«æ¥è‡ªç½‘ç»œæ‹“æ‰‘ç»“æ„çš„å€¼æ˜ å°„ï¼Œè¿™äº›å€¼æœ¬èº«æ²¡æœ‰æ„ä¹‰ã€‚\n\nggraph(hs_graph) +\n  geom_edge_link() +\n  geom_node_point()\n#> Using `stress` as default layout\n\nggraph(hs_graph, layout = \"drl\") +\n  geom_edge_link() +\n  geom_node_point()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nhs_graph <- hs_graph %>% \n  activate(edges) %>% \n  mutate(edge_weights = runif(n()))\nggraph(hs_graph, layout = \"stress\", weights = edge_weights) +\n  geom_edge_link(aes(alpha = edge_weights)) +\n  geom_node_point() +\n  scale_edge_alpha_identity()\n\n# ç¯å½¢\nggraph(luv_graph, layout = \"dendrogram\", circular = TRUE) +\n  geom_edge_link() +\n  coord_fixed()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.5.2 ç»˜åˆ¶èŠ‚ç‚¹ï¼ˆnodesï¼‰\n\n# åªæ˜¾ç¤º2ä¸ªä»¥ä¸Šçš„èŠ‚ç‚¹ï¼ŒæŒ‰ä¸­å¿ƒåº¦ç€è‰²\nggraph(hs_graph, layout = \"stress\") +\n  geom_edge_link() +\n  geom_node_point(\n    aes(filter = centrality_degree() > 2,\n        color = centrality_power()),\n    size = 2\n  )\n\n# æ ‘çŠ¶å›¾\nggraph(luv_graph, layout = \"treemap\") +\n  geom_node_tile(aes(fill = depth))\n#> Warning: Existing variables `height`, `leaf` overwritten by layout\n#> variables\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.5.3 ç»˜åˆ¶è¾¹ç¼˜ï¼ˆedgesï¼‰\n\nggraph(graph, layout = \"stress\") +\n  geom_edge_link(aes(alpha = after_stat(index)))\n\nggraph(graph, layout = \"stress\") +\n  geom_edge_link2(\n    aes(color = node.class),\n    width = 3, lineend = \"round\"\n  )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nggraph(hs_graph, layout = \"stress\") +\n  geom_edge_fan()\n\nggraph(hs_graph, layout = \"stress\") +\n  geom_edge_parallel()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nggraph(luv_graph, layout = \"dendrogram\", height = height) +\n  geom_edge_elbow()\n\nggraph(luv_graph, layout = \"dendrogram\", height = height) +\n  geom_edge_bend()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n# èŠ‚ç‚¹ä¼šé®ç›–ç®­å¤´\nggraph(graph, layout = \"stress\") +\n  geom_edge_link(arrow = arrow()) +\n  geom_node_point(aes(color = class), size = 6)\n\n# è§£å†³ä¸Šè¿°é—®é¢˜\nggraph(graph, layout = \"stress\") +\n  geom_edge_link(\n    arrow = arrow(),\n    start_cap = circle(3, \"mm\"),\n    end_cap = circle(3, \"mm\")\n  ) +\n  geom_node_point(aes(color = class), size = 6)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.5.4 åˆ†é¢\n\nggraph(hs_graph, layout = \"stress\") +\n  geom_edge_link() +\n  geom_node_point() +\n  facet_edges(~year)\n\n\n\n\n\n\n\n\nggraph(hs_graph, layout = \"stress\") +\n  geom_edge_link() +\n  geom_node_point() +\n  facet_nodes(~ group_spinglass())"
  },
  {
    "objectID": "vis-ggplot2-layers.html#æ³¨é‡Š",
    "href": "vis-ggplot2-layers.html#æ³¨é‡Š",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.6 æ³¨é‡Š",
    "text": "2.6 æ³¨é‡Š\nä»æ¦‚å¿µä¸Šè®²ï¼Œæ³¨é‡Šä¸ºç»˜å›¾æä¾›äº†å…ƒæ•°æ®ï¼Œå®ƒæä¾›äº†å…³äºæ•°æ®çš„é¢å¤–ä¿¡æ¯ã€‚\n\n2.6.1 å›¾å½¢å’Œè½´æ ‡é¢˜\n\nggplot(mpg, aes(displ, hwy)) +\n  geom_point(aes(color = factor(cyl))) +\n  labs(\n    x = \"Engine displacement (litres)\",\n    y = \"Highway miles per gallon\",\n    color = \"Number of cylinders\",\n    title = \"Mileage by engine size and cylinders\",\n    subtitle = \"Source: http://fueleconomy.gov\"\n  )\n\n\n\n\n\n\n\né€šå¸¸ç»™labs()æä¾›æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå¹¶ç”¨\\næŒ‡å®šæ¢è¡Œï¼Œä¹Ÿå¯ä»¥æä¾›ç”¨quote()åŒ…è£¹çš„æ•°å­¦è¡¨è¾¾å¼ï¼š\n\nvalues <- seq(from = -2, to = 2, by = .01)\ndf <- data.frame(x = values, y = values ^ 3)\nggplot(df, aes(x, y)) +\n  geom_line() +\n  labs(y = quote(f(x) == x^3))\n\n\n\n\n\n\n\nåœ¨ggtextåŒ…(Wilke 2020)å’Œggplot2ä¸»é¢˜ç³»ç»Ÿä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Markdownè¯­æ³•è¿›è¡Œæ ‡è®°ï¼š\n\ndf <- data.frame(x = 1:3, y = 1:3)\nbase <- ggplot(df, aes(x, y)) +\n  geom_point() +\n  labs(x = \"Axis title with *italics* and **boldface**\")\n\nbase\nbase + theme(axis.title.x = ggtext::element_markdown())\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\næœªå‡ºç°æ–œä½“å’ŒåŠ ç²—æ•ˆæœï¼Œæš‚æœªå‘ç°åŸå› ã€‚æ—¥åä¼šå¤„ç†ã€‚\n\n\n\n2.6.2 æ–‡æœ¬æ ‡ç­¾\nå­—ä½“\n\ndf <- data.frame(x = 1, y = 3:1, family = c(\"sans\", \"serif\", \"mono\"))\nggplot(df, aes(x, y)) +\n  geom_text(aes(label = family, family = family))\n\n\n\n\n\n\n\nå¦‚éœ€æ›´å¤šå­—ä½“ï¼Œä½¿ç”¨showtextåŒ…(Qiu and details. 2022)ï¼š\n\nlibrary(showtext)\n#> Loading required package: sysfonts\n#> Loading required package: showtextdb\n\n# font_install(source_han_serif()) # å®‰è£…å­—ä½“åº“\nfont_families()\n#> [1] \"sans\"                \"serif\"              \n#> [3] \"mono\"                \"wqy-microhei\"       \n#> [5] \"source-han-serif-cn\"\nhead(font_files()) # æŸ¥çœ‹ç³»ç»Ÿå­—ä½“\n#>               path         file       family        face\n#> 1 C:/Windows/Fonts  AGENCYB.TTF    Agency FB        Bold\n#> 2 C:/Windows/Fonts  AGENCYR.TTF    Agency FB     Regular\n#> 3 C:/Windows/Fonts    ALGER.TTF     Algerian     Regular\n#> 4 C:/Windows/Fonts  ANTQUAB.TTF Book Antiqua        Bold\n#> 5 C:/Windows/Fonts ANTQUABI.TTF Book Antiqua Bold Italic\n#> 6 C:/Windows/Fonts  ANTQUAI.TTF Book Antiqua      Italic\n#>        version                ps_name\n#> 1 Version 1.01          AgencyFB-Bold\n#> 2 Version 1.01           AgencyFB-Reg\n#> 3 Version 1.57               Algerian\n#> 4 Version 2.35       BookAntiqua-Bold\n#> 5 Version 2.35 BookAntiqua-BoldItalic\n#> 6 Version 2.35     BookAntiqua-Italic\n\n\nshowtext_auto()\n\nfont_add(\"simkai\", \"simkai.ttf\")\nfont_add(\"constan\", \"constan.ttf\", italic = \"constani.ttf\")\n\nggplot(NULL, aes(x = 1, y = 1)) + ylim(0.8, 1.2) +\n    theme(axis.title = element_blank(), axis.ticks = element_blank(),\n          axis.text = element_blank()) +\n    annotate(\"text\", 1, 1.1, family = \"simkai\", size = 15,\n             label = \"ä½ å¥½ï¼Œä¸–ç•Œï¼\") +\n    annotate(\"text\", 1, 0.9, label = 'Chinese for \"Hello, world!\"',\n             family = \"constan\", fontface = \"italic\", size = 8)\n\n\n\n\n\n\n\nåŠ ç²—ã€æ–œä½“\n\ndf <- data.frame(x = 1, y = 3:1, face = c(\"plain\", \"bold\", \"italic\"))\nggplot(df, aes(x, y)) +\n  geom_text(aes(label = face, fontface = face))\n\n\n\n\n\n\n\nå¯¹é½æ–¹å¼\n\ndf <- data.frame(\n  x = c(1, 1, 2, 2, 1.5),\n  y = c(1, 2, 1, 2, 1.5),\n  text = c(\n    \"bottom-left\", \"top-left\",\n    \"bottom-right\", \"top-right\", \"center\"\n  )\n)\n\nggplot(df, aes(x, y)) +\n  geom_text(aes(label = text))\nggplot(df, aes(x, y)) +\n  geom_text(aes(label = text), vjust = \"inward\", hjust = \"inward\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¾®è°ƒ\n\ndf <- data.frame(resp = c(1.2, 3.4, 2.5), trt = letters[1:3])\n\nggplot(df, aes(resp, trt)) +\n  geom_point() +\n  geom_text(aes(label = paste0(\"(\", resp, \")\"))) +\n  xlim(1, 3.6)\nggplot(df, aes(resp, trt)) +\n  geom_point() +\n  geom_text(aes(label = paste0(\"(\", resp, \")\")), nudge_y = -.25) +\n  xlim(1, 3.6)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\né‡å æ£€æŸ¥\næŒ‰ç…§æ ‡ç­¾åœ¨æ•°æ®æ¡†ä¸­å‡ºç°çš„å…ˆåé¡ºåºç»˜åˆ¶æ ‡ç­¾ã€‚å¦‚åæ¥çš„æ ‡ç­¾è¦†ç›–å·²ç»˜åˆ¶çš„æ ‡ç­¾ï¼Œåˆ™å¿½ç•¥åæ¥çš„æ ‡ç­¾ã€‚å®é™…ä½¿ç”¨ä¸­ï¼Œå¯ä»¥å¯¹æ ‡ç­¾è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œåç»˜åˆ¶å¸¦æœ‰æ ‡ç­¾çš„å›¾ï¼Œä»¥å¼ºè°ƒé‡è¦çš„æ•°æ®ã€‚\n\nggplot(mpg, aes(displ, hwy)) +\n  geom_text(aes(label = model)) +\n  xlim(1, 8)\nggplot(mpg, aes(displ, hwy)) +\n  geom_text(aes(label = model), check_overlap = TRUE) +\n  xlim(1, 8)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨ggrepelåŒ…(Slowikowski 2021)çš„geom_text_repel()å‡½æ•°è¿›è¡Œç»˜åˆ¶ï¼š\n\nmini_mpg <- mpg[sample(nrow(mpg), 20), ]\nggplot(mpg, aes(displ, hwy)) +\n  geom_point(color = \"red\") +\n  ggrepel::geom_text_repel(data = mini_mpg, aes(label = class))\n#> Warning: ggrepel: 6 unlabeled data points (too many overlaps).\n#> Consider increasing max.overlaps\n\n\n\n\n\n\n\nggfittextåŒ…(Wilkins 2021)å¯ä»¥ç¡®ä¿æ–‡æœ¬æ ‡ç­¾é€‚åº”å…¶æ”¾ç½®çš„ç©ºé—´ï¼š\n\nlibrary(ggfittext)\nggplot(animals, aes(type, flies, label = animal)) +\n  geom_tile(fill = \"white\", color = \"black\") +\n  geom_fit_text()\nggplot(animals, aes(type, flies, label = animal)) +\n  geom_tile(fill = \"white\", color = \"black\") +\n  geom_fit_text(reflow = TRUE)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.6.3 è‡ªå®šä¹‰æ³¨é‡Š\n\nggplot(economics, aes(date, unemploy)) +\n  geom_line()\n\n# ç¾å›½æ€»ç»Ÿä»»æœŸå’Œå…šæ´¾\npresidential <- subset(presidential, start > economics$date[1])\nggplot(economics) +\n  geom_rect(data = presidential,\n            aes(xmin = start, xmax = end, fill = party),\n            ymin = -Inf, ymax = Inf, alpha = .2) +\n  geom_vline(data = presidential,\n             aes(xintercept = as.numeric(start)),\n             color = \"grey50\", alpha = .5) +\n  geom_text(data = presidential,\n            aes(start, y = 2500, label = name),\n            size = 3, vjust = 0, hjust = 0, nudge_x = 50) +\n  geom_line(aes(date, unemploy)) +\n  scale_fill_manual(values = c(\"blue\", \"red\")) +\n  labs(x = \"date\", y = \"unemployment\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\np <- ggplot(mpg, aes(displ, hwy)) +\n  geom_point(data = filter(mpg, manufacturer == \"subaru\"),\n             color = \"orange\", size = 3) +\n  geom_point()\n\np + \n  annotate(\"point\", x = 5.5, y = 40, color = \"orange\", size = 3) +\n  annotate(\"point\", x = 5.5, y = 40) +\n  annotate(\"text\", x = 5.6, y = 40, label = \"subaru\", hjust = \"left\")\n\n# æ›´å¥½çš„æ–¹æ³•\np +\n  annotate(\"curve\", x = 4, y = 35, xend = 2.65, yend = 27,\n           curvature = .3, arrow = arrow(length = unit(2, \"mm\"))) +\n  annotate(\"text\", x = 4.1, y = 35, label = \"subaru\", hjust = \"left\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.6.4 ç›´æ¥æ ‡æ³¨\ndirectlabelsåŒ…(Hocking 2021)ï¼š\n\nggplot(mpg, aes(displ, hwy, color = class)) +\n  geom_point()\n\nggplot(mpg, aes(displ, hwy, color = class)) +\n  geom_point(show.legend = FALSE) +\n  directlabels::geom_dl(aes(label = class), method = \"smart.grid\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nggforceåŒ…(Pedersen 2021a):\n\nggplot(mpg, aes(displ, hwy)) +\n  geom_point() +\n  ggforce::geom_mark_ellipse(aes(label = cyl, group = cyl))\n\n\n\n\n\n\n\ngghighlightåŒ…(Yutani 2022)ï¼š\n\ndata(Oxboys, package = \"nlme\")\nggplot(Oxboys, aes(age, height, group = Subject)) +\n  geom_line() +\n  geom_point() +\n  gghighlight::gghighlight(Subject %in% 1:3)\n\n\n\n\n\n\n\nåˆ†é¢æ³¨é‡Šï¼š\n\nggplot(mpg, aes(displ, hwy, color = factor(cyl))) +\n  geom_point() +\n  gghighlight::gghighlight() +\n  facet_wrap(vars(cyl))"
  },
  {
    "objectID": "vis-ggplot2-layers.html#å›¾å½¢æ’åˆ—",
    "href": "vis-ggplot2-layers.html#å›¾å½¢æ’åˆ—",
    "title": "2Â  ggplot2-layers",
    "section": "\n2.7 å›¾å½¢æ’åˆ—",
    "text": "2.7 å›¾å½¢æ’åˆ—\nggplot2çš„è¯­æ³•æ˜¯å…³äºåˆ›å»ºå•ä¸ªå›¾å½¢çš„ï¼Œè™½ç„¶åˆ†é¢ç³»ç»Ÿæä¾›äº†äº§ç”Ÿå¤šä¸ªå­å›¾çš„æ–¹æ³•ï¼Œä½†éƒ½å±äºåŒä¸€ä¸ªå¯è§†åŒ–çš„éƒ¨åˆ†ï¼Œå®ƒä»¬å…±äº«å›¾å±‚ã€æ•°æ®å’Œæ ‡åº¦ã€‚æˆ‘ä»¬ç»å¸¸éœ€è¦å°†å¤šå¹…ç‹¬ç«‹åˆ›å»ºçš„å›¾å½¢ç»„åˆä¸ºä¸€å¼ å›¾ï¼Œè®¸å¤šåŒ…å·²åº”è¿è€Œç”Ÿï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»patchworkåŒ…(Pedersen 2020)ã€‚\nç»˜åˆ¶å››å¹…å›¾å½¢ç”¨äºæ’åˆ—ï¼š\n\np1 <- ggplot(mpg) + \n  geom_point(aes(x = displ, y = hwy))\n\np2 <- ggplot(mpg) + \n  geom_bar(aes(x = as.character(year), fill = drv), position = \"dodge\") + \n  labs(x = \"year\")\n\np3 <- ggplot(mpg) + \n  geom_density(aes(x = hwy, fill = drv), colour = NA) + \n  facet_grid(rows = vars(drv))\n\np4 <- ggplot(mpg) + \n  stat_summary(aes(x = drv, y = hwy, fill = drv), geom = \"col\", fun.data = mean_se) +\n  stat_summary(aes(x = drv, y = hwy), geom = \"errorbar\", fun.data = mean_se, width = 0.5)\n\n\nlibrary(patchwork)\n\np1 + p2\n\n\n\n\n\n\n\n+å¹¶æœªæŒ‡å®šä»»ä½•å…·ä½“çš„å¸ƒå±€ï¼Œåªæ˜¯å°†å›¾å½¢æ˜¾ç¤ºåœ¨ä¸€èµ·ã€‚åœ¨æ²¡æœ‰å¸ƒå±€çš„æƒ…å†µä¸‹ï¼Œfacet_wrap()ä¸­ç®¡ç†è¡Œå’Œåˆ—çš„ç®—æ³•å°†ç”¨äºå†³å®šè¡Œæ•°å’Œåˆ—æ•°ã€‚å¦‚æœæˆ‘ä»¬æ·»åŠ 3å¹…å›¾å½¢ï¼Œåˆ™ä¼šåˆ›å»º1Ã—3çš„ç½‘æ ¼ï¼›æ·»åŠ 4å¹…å›¾å½¢ï¼Œåˆ™ä¼šåˆ›å»º2Ã—2çš„ç½‘æ ¼ã€‚\n\np1 + p2 + p3 + p4\n\n\n\n\n\n\n\nå¯ä»¥çœ‹å‡ºï¼Œpatchworkå…³æ³¨ç»˜å›¾åŒºåŸŸçš„å¯¹é½ã€‚\n\n2.7.1 å¸ƒå±€æ§åˆ¶\n\np1 + p2 + p3 + plot_layout(ncol = 2)\n\n\n\n\n\n\n\n/è®¾ç½®åˆ—æ•°ä¸º1ï¼Œ|è®¾ç½®è¡Œæ•°ä¸º1ï¼š\n\n# ä¸¤å¹…å›¾æ’ä¸º1åˆ—\np1 / p2\n\n\n\n\n\n\n\n\n# ä¸¤å¹…å›¾æ’ä¸º1è¡Œ\np3 | p4\n\n\n\n\n\n\n\n/å’Œ|å¯ä»¥è¿›è¡Œç»„åˆä»¥åˆ›å»ºæ›´åŠ å¤æ‚çš„å›¾å½¢æ’åˆ—ï¼š\n\np3 | (p2 / (p1 | p4))\n\n\n\n\n\n\n\né’ˆå¯¹ç‰¹åˆ«å¤æ‚çš„å¸ƒå±€ï¼Œå¯ä»¥åœ¨plot_layout()çš„designå‚æ•°ä¸­åˆ¶å®šæ–‡æœ¬å½¢å¼çš„éè¡¨æ ¼å¸ƒå±€ï¼š\n\nlayout <- \"\nAAB\nC#B\nCDD\n\"\nlayout\n#> [1] \"\\nAAB\\nC#B\\nCDD\\n\"\n\np1 + p2 + p3 + p4 + plot_layout(design = layout)\n\n\n\n\n\n\n\nä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œå›¾å½¢é—´çš„å›¾ä¾‹ç»å¸¸æœ‰å¤šä½™ï¼Œpatchworkæä¾›äº†ç®€ä¾¿çš„å¤„ç†æ–¹æ³•ï¼Œå¯ä»¥åˆ é™¤å®Œå…¨ä¸€æ ·çš„å›¾ä¾‹ï¼š\n\np1 + p2 + p3 + plot_layout(ncol = 2, guides = \"collect\")\n\n\n\n\n\n\n\nå¯ä»¥æŒ‡å®šç»˜å›¾åŒºåŸŸï¼Œä¼˜åŒ–ç©ºé—´ä½¿ç”¨ï¼š\n\np1 + p2 + p3 + guide_area() + plot_layout(ncol = 2, guides = \"collect\")\n\n\n\n\n\n\n\n\n2.7.2 ä¿®æ”¹å­å›¾\nåœ¨patchworkæ¸²æŸ“å‰ï¼Œæ‰€æœ‰å­å›¾ä»ä¸ºggplotå¯¹è±¡ï¼Œå› æ­¤åœ¨ç»„åˆèµ·æ¥åå¯ä»¥è¢«ä¿®æ”¹ï¼Œä½¿ç”¨[[]]ç´¢å¼•åè¿›è¡Œè°ƒæ•´ï¼š\n\np12 <- p1 + p2\np12[[2]] <- p12[[2]] + theme_light()\np12\n\n\n\n\n\n\n\nä½¿ç”¨&ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰å­å›¾ï¼š\n\np1 + p4 & theme_minimal()\n\n\n\n\n\n\n\nå¦‚æœå›¾å½¢åœ¨è½´ä¸Šå…·æœ‰ç›¸åŒçš„æ˜ å°„ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹æ³•æŒ‡å®šå…±åŒè½´ï¼š\n\np1 + p4 & scale_y_continuous(limits = c(0, 45))\n\n\n\n\n\n\n\n\n2.7.3 æ·»åŠ æ³¨é‡Š\nä¸€æ—¦å›¾å½¢ç»„åˆå®Œæ¯•ï¼Œå®ƒä»¬å°±æˆä¸ºä¸€ä¸ªæ•´ä½“ï¼Œå¯ä»¥é€šè¿‡plot_annotation()å‘æ•´ä½“æ·»åŠ æ ‡é¢˜ã€å‰¯æ ‡é¢˜ç­‰æ³¨é‡Šã€‚\n\np34 <- p3 + p4 + plot_annotation(\n  title = \"A closer look at the effect of drive train in cars\",\n  caption = \"Source: mpg dataset in ggplot2\"\n)\np34\n\n\n\n\n\n\n\n\np34 + plot_annotation(theme = theme_gray(base_family = \"mono\"))\n\n\n\n\n\n\n\nä¸ºå­å›¾æ·»åŠ æ ‡ç­¾åœ¨ç§‘å­¦æ–‡çŒ®ä¸­å°¤å…¶å¸¸ç”¨ï¼Œggplot2å¸¦æœ‰tagå…ƒç´ ï¼Œpatchworkæä¾›tag_levelså‚æ•°è¿›è¡Œè‡ªåŠ¨è®¾ç½®ï¼š\n\np123 <- p1 | (p2 / p3)\np123 + plot_annotation(tag_levels = \"I\") # ä½¿ç”¨å¤§å†™ç½—é©¬æ•°å­—\n\n\n\n\n\n\n\nä½¿ç”¨åµŒå¥—å®šä¹‰æ–°çš„æ ‡ç­¾çº§åˆ«ï¼š\n\np123[[2]] <- p123[[2]] + plot_layout(tag_level = \"new\")\np123 + plot_annotation(tag_levels = c(\"I\", \"a\"))\n\n\n\n\n\n\n\n\n2.7.4 å›¾å½¢å åŠ \npatchworkæä¾›äº†inset_element()å‡½æ•°ç”¨äºåœ¨ç»™å®šçš„åŒºåŸŸä¸Šæ”¾ç½®å›¾å½¢ï¼š\n\np1 + inset_element(p2, left = .5, bottom = .4, right = .9, top = .95)\n\n\n\n\n\n\n\n\np24 <- p2 / p4 + plot_layout(guides = \"collect\")\np1 + inset_element(p24, left = .5, right = .9, bottom = .05, top = .9)\n\n\n\n\n\n\n\n\np12 <- p1 + inset_element(p2, left = .5, right = .9, bottom = .5, top = .95)\np12 & theme_bw()\n\n\n\n\n\n\n\n\np12 + plot_annotation(tag_levels = \"A\")\n\n\n\n\n\n\n\næ›´å¤špatchworkçš„åŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹å®ƒçš„ç½‘ç«™ï¼šhttps://patchwork.data-imaginist.com/ã€‚\n\n\n\n\nHocking, Toby Dylan. 2021. â€œDirectlabels: Direct Labels for Multicolor Plots.â€ https://CRAN.R-project.org/package=directlabels.\n\n\nPebesma, Edzer. 2018. â€œSimple Features for r: Standardized Support for Spatial Vector Dataâ€ 10. https://doi.org/10.32614/RJ-2018-009.\n\n\nâ€”â€”â€”. 2022. â€œStars: Spatiotemporal Arrays, Raster and Vector Data Cubes.â€ https://CRAN.R-project.org/package=stars.\n\n\nPedersen, Thomas Lin. 2020. â€œPatchwork: The Composer of Plots.â€ https://CRAN.R-project.org/package=patchwork.\n\n\nâ€”â€”â€”. 2021a. â€œGgforce: Accelerating â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggforce.\n\n\nâ€”â€”â€”. 2021b. â€œGgraph: An Implementation of Grammar of Graphics for Graphs and Networks.â€ https://CRAN.R-project.org/package=ggraph.\n\n\nâ€”â€”â€”. 2022. â€œTidygraph: A Tidy API for Graph Manipulation.â€ https://CRAN.R-project.org/package=tidygraph.\n\n\nQiu, Yixuan, and authors/contributors of the included software. See file AUTHORS for details. 2022. â€œShowtext: Using Fonts More Easily in r Graphs.â€ https://CRAN.R-project.org/package=showtext.\n\n\nSlowikowski, Kamil. 2021. â€œGgrepel: Automatically Position Non-Overlapping Text Labels with â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggrepel.\n\n\nSparks, Adam H, Mark Padgham, Hugh Parsonage, and Keith Pembleton. 2017. â€œBomrang: Fetch Australian Government Bureau of Meteorology Weather Dataâ€ 2. https://doi.org/10.21105/joss.00411.\n\n\nTeucher, Andy, and Kenton Russell. 2022. â€œRmapshaper: Client for â€™Mapshaperâ€™ for â€™Geospatialâ€™ Operations.â€ https://CRAN.R-project.org/package=rmapshaper.\n\n\nWilke, Claus O. 2020. â€œGgtext: Improved Text Rendering Support for â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggtext.\n\n\nWilkins, David. 2021. â€œGgfittext: Fit Text Inside a Box in â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggfittext.\n\n\nYutani, Hiroaki. 2022. â€œGghighlight: Highlight Lines and Points in â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=gghighlight."
  },
  {
    "objectID": "vis-ggplot2-scales.html",
    "href": "vis-ggplot2-scales.html",
    "title": "3Â  ggplot2-scales",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚æ­£åœ¨è¿›è¡Œå†™ä½œå’Œç»“æ„è°ƒæ•´ï¼Œå¯èƒ½å‡ºç°æ··ä¹±æˆ–ä¸å®Œæ•´çš„æƒ…å†µã€‚\næ ‡åº¦æ§åˆ¶æ•°æ®åˆ°ç¾å­¦çš„æ˜ å°„ï¼Œå®ƒå°†æ•°æ®è½¬ä¸ºå¤§å°ï¼ˆsizeï¼‰ã€é¢œè‰²ï¼ˆcolorï¼‰ã€ä½ç½®ï¼ˆpositionï¼‰æˆ–å½¢çŠ¶ï¼ˆshapeï¼‰ï¼Œå®ƒä¹Ÿæä¾›äº†è§£é‡Šç»˜å›¾çš„å·¥å…·ï¼šåæ ‡è½´å’Œå›¾ä¾‹ã€‚"
  },
  {
    "objectID": "vis-ggplot2-scales.html#ä½ç½®æ ‡åº¦å’Œåæ ‡è½´",
    "href": "vis-ggplot2-scales.html#ä½ç½®æ ‡åº¦å’Œåæ ‡è½´",
    "title": "3Â  ggplot2-scales",
    "section": "\n3.1 ä½ç½®æ ‡åº¦å’Œåæ ‡è½´",
    "text": "3.1 ä½ç½®æ ‡åº¦å’Œåæ ‡è½´\n\n3.1.1 æ•°å€¼å‹\nLimits\nlims()æˆ–limitså‚æ•°å¯ç”¨äºä¿®æ”¹åæ ‡è½´èŒƒå›´ï¼Œéœ€è¦æ¥å—é•¿åº¦ä¸º2çš„æ•°å€¼å‹å‘é‡ã€‚å¦‚æœåªè®¾ç½®å•ä¾§èŒƒå›´ï¼Œå¦ä¸€ä¾§è®¾ç½®ä¸ºNAã€‚\n\nmpg %>% filter(year == 1999) %>% \n  ggplot(aes(displ, hwy)) +\n  geom_point() +\n  scale_x_continuous(limits = c(1, 7)) +\n  scale_y_continuous(limits = c(10, 45))\n\nmpg %>% filter(year == 2008) %>% \n  ggplot(aes(displ, hwy)) +\n  geom_point() +\n  lims(x = c(1, 7), y = c(10, 45))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nZooming in\nå¦‚æœç›®æ ‡æ˜¯æ”¾å¤§ç»˜å›¾çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨coord_cartesian()çš„xlimå’Œylimå‚æ•°é€šå¸¸ä¼šæ›´å¥½ã€‚\n\nbase <- ggplot(mpg, aes(drv, hwy)) +\n  geom_hline(yintercept = 28, color = \"red\") +\n  geom_boxplot()\n\nbase\nbase + coord_cartesian(ylim = c(10, 35))\nbase + ylim(10, 35)\n#> Warning: Removed 6 rows containing non-finite values (stat_boxplot).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nVisual range expansion\n\nbase <- ggplot(faithfuld, aes(waiting, eruptions)) +\n  geom_raster(aes(fill = density)) +\n  theme(legend.position = \"none\") +\n  labs(x = NULL, y = NULL)\n\nbase\nbase + \n  scale_x_continuous(expand = expansion(0)) +\n  scale_y_continuous(expand = expansion(0))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbase + \n  scale_x_continuous(expand = expansion(add = 3)) +\n  scale_y_continuous(expand = expansion(add = 3))\n\nbase +\n  scale_x_continuous(expand = expansion(mult = .2)) +\n  scale_y_continuous(expand = expansion(mult = .2))\n\nbase +\n  scale_x_continuous(expand = expansion(mult = c(.05, .2))) +\n  scale_y_continuous(expand = c(.05, 0, .2, 0))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\naddå‚æ•°æ˜¯åœ¨ä¸æ•°æ®å˜é‡ç›¸åŒçš„å°ºåº¦ä¸ŠæŒ‡å®šçš„ï¼Œmultå‚æ•°æ˜¯ç›¸å¯¹äºè½´çš„èŒƒå›´æŒ‡å®šçš„ã€‚\nBreaks\n\ntoy <- data.frame(\n  const = 1,\n  up = 1:4,\n  txt = letters[1:4],\n  big = (1:4) * 1000,\n  log = c(2, 5, 10, 2000)\n)\ntoy\n#>   const up txt  big  log\n#> 1     1  1   a 1000    2\n#> 2     1  2   b 2000    5\n#> 3     1  3   c 3000   10\n#> 4     1  4   d 4000 2000\n\né€šè¿‡å‘breakså‚æ•°ä¼ é€’æ•°å€¼ï¼Œå¯æ‰‹åŠ¨è®¾ç½®æ–­ç‚¹ã€‚è®¾ç½®breaks = NULLç§»é™¤æ–­ç‚¹å’Œç›¸å…³çš„åˆ»åº¦çº¿ã€‚\n\nbase <- ggplot(toy, aes(big, const)) +\n  geom_point() +\n  labs(x = NULL, y = NULL) +\n  scale_y_continuous(breaks = NULL)\nbase\n\n\n\n\n\n\n\néœ€æ³¨æ„ï¼Œæ‰‹åŠ¨è®¾ç½®æ–­ç‚¹ä¼šç§»åŠ¨ä¸»è¦å’Œæ¬¡è¦ç½‘æ ¼çº¿ï¼š\n\nbase + scale_x_continuous(breaks = c(1000, 2000, 4000))\nbase + scale_x_continuous(breaks = c(1000, 1500, 2000, 4000))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nä¹Ÿå¯ä»¥å‘breaksä¼ é€’å‡½æ•°ï¼Œè¯¥å‡½æ•°åº”æœ‰ä¸€ä¸ªæŒ‡å®šæ ‡åº¦èŒƒå›´çš„å‚æ•°ï¼ˆé•¿åº¦ä¸º2çš„æ•°å€¼å‹å‘é‡ï¼‰ï¼Œå¹¶ä¸”è¿”å›æ–­ç‚¹çš„æ•°å€¼å‹å‘é‡ã€‚scalesåŒ…(H. Wickham and Seidel 2022)æä¾›äº†ä¸€äº›æœ‰ç”¨çš„å·¥å…·ï¼š\n\n\nscales::breaks_extended()ä¸ºæ•°å€¼è½´è‡ªåŠ¨åˆ›å»ºæ–­ç‚¹ï¼ˆggplot2çš„æ ‡å‡†æ–¹æ³•ï¼‰ï¼›\n\nscales::breaks_log()ä¸ºå¯¹æ•°è½´è‡ªåŠ¨åˆ›å»ºæ–­ç‚¹ï¼›\n\nscales::breaks_pretty()ä¸ºæ—¥æœŸ/æ—¶é—´åˆ›å»ºæ–­ç‚¹ï¼›\n\nscales::breaks_width()åˆ›å»ºç­‰è·çš„æ–­ç‚¹ã€‚\n\n\nbase + \n  scale_x_continuous(breaks = scales::breaks_width(800))\nbase + \n  scale_x_continuous(breaks = scales::breaks_width(800, offset = 200)) # åç§»\nbase +\n  scale_x_continuous(breaks = scales::breaks_width(800, offset = -200))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nMinor breaks\næ¬¡è¦æ–­ç‚¹ï¼ˆä¸»ç½‘æ ¼çº¿ä¹‹é—´æœªæ ‡è®°çš„ç½‘æ ¼çº¿ï¼‰å¯¹äºå¯¹æ•°è½´ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæ¸…æ™°åœ°å±•ç¤ºäº†åˆ»åº¦æ˜¯éçº¿æ€§çš„ã€‚\n\nmb <- unique(as.numeric(1:10 %o% 10 ^ (0:3)))\nmb\n#>  [1]     1     2     3     4     5     6     7     8     9    10\n#> [11]    20    30    40    50    60    70    80    90   100   200\n#> [21]   300   400   500   600   700   800   900  1000  2000  3000\n#> [31]  4000  5000  6000  7000  8000  9000 10000\n\n\nbase <- ggplot(toy, aes(log, const)) +\n  geom_point() +\n  labs(x = NULL, y = NULL) +\n  scale_y_continuous(breaks = NULL)\n\nbase + scale_x_log10()\nbase + scale_x_log10(minor_breaks = mb)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLabels\n\nbase <- ggplot(toy, aes(big, const)) +\n  geom_point() +\n  labs(x = NULL, y = NULL) +\n  scale_y_continuous(breaks = NULL)\n\nbase\nbase + scale_x_continuous(\n  breaks = c(2000, 4000),\n  labels = c(\"2k\", \"4k\")\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\né€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®labelså‚æ•°ï¼Œå’Œbreakså‚æ•°ä¸€æ ·ï¼ŒscalesåŒ…æä¾›äº†æœ‰æ•ˆçš„å‡½æ•°ï¼š\n\n\nscales::label_bytes()å°†æ•°å­—è½¬åŒ–ä¸ºkbã€mbç­‰å­—èŠ‚æ ¼å¼ï¼›\n\nscales::label_comma()ä¸ºæ•°å­—æ·»åŠ é€—å·ï¼›\n\nscales::label_dollar()å°†æ•°å­—è½¬ä¸ºè´§å¸ï¼›\n\nscales::label_ordinal()å°†æ•°å­—è½¬ä¸ºç­‰çº§é¡ºåºï¼›\n\nscales::label_percent()å°†æ•°å­—è½¬ä¸ºç™¾åˆ†æ•°ï¼›\n\nscales::label_pvalue()å°†æ•°å­—è½¬ä¸ºpå€¼ã€‚\n\n\nbase <- ggplot(toy, aes(big, const)) +\n  geom_point() +\n  labs(x = NULL, y = NULL) +\n  scale_x_continuous(breaks = NULL)\n\nbase\nbase + scale_y_continuous(labels = scales::label_percent())\nbase + scale_y_continuous(labels = scales::label_dollar(prefix = \"\", suffix = \"â‚¬\")) # é»˜è®¤å‰ç¼€$\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\næ³¨æ„breaks = NULLå’Œlabels = NULLçš„å·®åˆ«ï¼š\n\nbase + scale_y_continuous(breaks = NULL)\nbase + scale_y_continuous(labels = NULL)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTransformations\næ¯ä¸€ä¸ªè¿ç»­çš„æ ‡åº¦éƒ½å¸¦æœ‰å…è®¸ä½¿ç”¨å„ç§è½¬æ¢çš„transå‚æ•°ã€‚\n\nggplot(mpg, aes(displ, hwy)) +\n  geom_point() +\n  scale_y_continuous(trans = \"reciprocal\") # yè½´å–å€’æ•°\n\n# xå’Œyè½´å–10ä¸ºåº•çš„å¯¹æ•°\nggplot(diamonds, aes(price, carat)) +\n  geom_bin2d() +\n  scale_x_continuous(trans = \"log10\") +\n  scale_y_continuous(trans = \"log10\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¯ä»¥ä½¿ç”¨scales::trans_new()æ„å»ºè½¬æ¢ï¼ŒscalesåŒ…åŒæ ·æä¾›äº†è®¸å¤šå¸¸è§çš„è½¬æ¢ï¼š\n\n\n\n\n\n\n\n\nName\nTransformer\nFunction \\(f(x)\\)\n\nInverse \\(f^{-1}(x)\\)\n\n\n\n\n\"asn\"\nscales::asn_trans()\n\\(\\tanh^{-1}(x)\\)\n\\(\\tanh(y)\\)\n\n\n\"exp\"\nscales::exp_trans()\n\\(e ^ x\\)\n\\(\\log(y)\\)\n\n\n\"identity\"\nscales::identity_trans()\n\\(x\\)\n\\(y\\)\n\n\n\"log\"\nscales::log_trans()\n\\(\\log(x)\\)\n\\(e ^ y\\)\n\n\n\"log10\"\nscales::log10_trans()\n\\(\\log_{10}(x)\\)\n\\(10 ^ y\\)\n\n\n\"log2\"\nscales::log2_trans()\n\\(\\log_2(x)\\)\n\\(2 ^ y\\)\n\n\n\"logit\"\nscales::logit_trans()\n\\(\\log(\\frac{x}{1 - x})\\)\n\\(\\frac{1}{1 + e(y)}\\)\n\n\n\"probit\"\nscales::probit_trans()\n\\(\\Phi(x)\\)\n\\(\\Phi^{-1}(y)\\)\n\n\n\"reciprocal\"\nscales::reciprocal_trans()\n\\(x^{-1}\\)\n\\(y^{-1}\\)\n\n\n\"reverse\"\nscales::reverse_trans()\n\\(-x\\)\n\\(-y\\)\n\n\n\"sqrt\"\nscales::scale_x_sqrt()\n\\(x^{1/2}\\)\n\\(y ^ 2\\)\n\n\n\nå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿›è¡Œè¿™äº›è½¬æ¢ï¼Œç»˜åˆ¶çš„å›¾å½¢å¤–è§‚æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åˆ»åº¦æ ‡ç­¾å°†æœ‰æ‰€å·®å¼‚ã€‚å…·ä½“æ¥è®²ï¼Œå¦‚æœä½¿ç”¨è½¬æ¢æ ‡åº¦ï¼Œåˆ»åº¦æ ‡ç­¾å°†å±•ç¤ºåŸå§‹çš„æ•°æ®ç©ºé—´ï¼›å¦‚æœæ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼Œåˆ»åº¦æ ‡ç­¾å°†å±•ç¤ºè½¬æ¢åçš„æ•°æ®ç©ºé—´ã€‚\n\n# æ‰‹åŠ¨è½¬æ¢æ•°æ®\nggplot(mpg, aes(log10(displ), hwy)) +\n  geom_point()\n\n# è½¬æ¢æ ‡åº¦\nggplot(mpg, aes(displ, hwy)) +\n  geom_point() +\n  scale_x_log10()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3.1.2 æ—¥æœŸ-æ—¶é—´å‹\nBreaks\ndata_breakså‚æ•°å…è®¸ä»¥æ—¥æœŸå•ä½ï¼ˆå¹´ã€æœˆã€æ˜ŸæœŸã€æ—¥ã€å°æ—¶ã€åˆ†ã€ç§’ï¼‰ç¡®å®šæ–­ç‚¹ï¼š\n\ndate_base <- ggplot(economics, aes(date, psavert)) +\n  geom_line(na.rm = TRUE) +\n  labs(x = NULL, y = NULL)\n\ndate_base\ndate_base + scale_x_date(date_breaks = \"15 years\")\n\n\n\n\n\n\n\n\n\n\n\n\n\ndate_breaks = \"15 years\"æ˜¯breaks = scales::breaks_width(\"15 years\")çš„ç¼©å†™ã€‚å¦‚æœéœ€è¦ä½¿ç”¨åç§»ï¼Œé•¿æ ¼å¼æ›´æœ‰ç”¨ã€‚æ¯”å¦‚ç»˜åˆ¶è·¨è¶Šä¸€ä¸ªæ—¥å†å¹´çš„æ•°æ®ï¼Œå¹¶æŒ‰æœˆåˆ’åˆ†ï¼š\n\nthe_year <- as.Date(c(\"2021-01-01\", \"2021-12-31\"))\nset_breaks <- scales::breaks_width(\"1 month\")\nset_breaks(the_year)\n#>  [1] \"2021-01-01\" \"2021-02-01\" \"2021-03-01\" \"2021-04-01\"\n#>  [5] \"2021-05-01\" \"2021-06-01\" \"2021-07-01\" \"2021-08-01\"\n#>  [9] \"2021-09-01\" \"2021-10-01\" \"2021-11-01\" \"2021-12-01\"\n#> [13] \"2022-01-01\"\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œscales::break_width()è¿”å›çš„set_breaks()å‡½æ•°äº§ç”Ÿäº†é—´éš”ä¸€ä¸ªæœˆçš„æ–­ç‚¹ï¼Œå…¶ä¸­æ¯ä¸ªæ–­ç‚¹çš„æ—¥æœŸéƒ½åœ¨è¯¥æœˆçš„ç¬¬ä¸€å¤©ã€‚é€šå¸¸å°†æ¯ä¸ªæ–­ç‚¹æ”¾åœ¨æ—¥å†å¹´çš„å¼€å§‹ä½ç½®ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ã€‚å‡å¦‚æ•°æ®è¿½è¸ªçš„æ˜¯ä¸€ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºï¼Œå…¶ä¸­æ¯æœˆçš„å·¥èµ„æ˜¯åœ¨æ¯ä¸ªæœˆçš„ç¬¬ä¹å¤©æ”¯ä»˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´æ˜æ™ºçš„åšæ³•æ˜¯è®©æ–­ç‚¹ä¸å·¥èµ„å­˜æ¬¾ä¿æŒä¸€è‡´ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨å®šä¹‰set_breaks()å‡½æ•°æ—¶è®¾ç½®offset = 8ï¼š\n\nset_breaks <- scales::breaks_width(\"1 month\", offset = 8)\nset_breaks(the_year)\n#>  [1] \"2021-01-09\" \"2021-02-09\" \"2021-03-09\" \"2021-04-09\"\n#>  [5] \"2021-05-09\" \"2021-06-09\" \"2021-07-09\" \"2021-08-09\"\n#>  [9] \"2021-09-09\" \"2021-10-09\" \"2021-11-09\" \"2021-12-09\"\n#> [13] \"2022-01-09\"\n\nMinor breaks\n\ndf <- data.frame(y = as.Date(c(\"2022-01-01\", \"2022-04-01\")))\nbase <- ggplot(df, aes(y = y)) +\n  labs(y = NULL) +\n  theme_minimal() +\n  theme(\n    panel.grid.major = element_line(color = \"black\"),\n    panel.grid.minor = element_line(color = \"grey50\")\n  )\n\nbase + scale_y_date(date_breaks = \"1 month\")\nbase + scale_y_date(date_breaks = \"1 month\", date_minor_breaks = \"1 week\")\n\n\n\n\n\n\n\n\n\n\n\n\n\nLabels\næ—¥æœŸåˆ»åº¦æ ‡ç­¾ä½¿ç”¨date_labelså‚æ•°ä¼ é€’æ ¼å¼åŒ–å­—ç¬¦ä¸²æ›´åŠ ä¾¿æ·ã€‚æ¯”å¦‚ï¼Œ14/10/1979å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²\"%d%m%y\"å±•ç¤ºã€‚å­—ç¬¦ä¸²åˆ—è¡¨å¦‚ä¸‹ï¼š\n\n\nString\nMeaning\n\n\n\n%S\nsecond (00-59)\n\n\n%M\nminute (00-59)\n\n\n%l\nhour, in 12-hour clock (1-12)\n\n\n%I\nhour, in 12-hour clock (01-12)\n\n\n%p\nam/pm\n\n\n%H\nhour, in 24-hour clock (00-23)\n\n\n%a\nday of week, abbreviated (Mon-Sun)\n\n\n%A\nday of week, full (Monday-Sunday)\n\n\n%e\nday of month (1-31)\n\n\n%d\nday of month (01-31)\n\n\n%m\nmonth, numeric (01-12)\n\n\n%b\nmonth, abbreviated (Jan-Dec)\n\n\n%B\nmonth, full (January-December)\n\n\n%y\nyear, without century (00-99)\n\n\n%Y\nyear, with century (0000-9999)\n\n\n\nä¸€ä¸ªå¸¸ç”¨åœºæ™¯æ˜¯ï¼šå½“æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥æŒ‡å®šå››ä½æ•°çš„å¹´ä»½æ—¶ï¼Œä½¿ç”¨%yå¯ä»¥ç¡®ä¿åªæ˜¾ç¤ºæœ€åä¸¤ä½æ•°å­—ã€‚\n\nbase <- ggplot(economics, aes(date, psavert)) +\n  geom_line(na.rm = TRUE) +\n  labs(x = NULL, y = NULL)\n\nbase + scale_x_date(date_breaks = \"5 years\")\nbase + scale_x_date(date_breaks = \"5 years\", date_labels = \"%y\")\n\n\n\n\n\n\n\n\n\n\n\n\n\næ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­åŒ…å«æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰åœ¨æ–‡æœ¬è¾ƒé•¿çš„æƒ…å†µä¸‹å¯èƒ½å¾ˆæœ‰ç”¨ï¼š\n\nlim <- as.Date(c(\"2004-01-01\", \"2005-01-01\"))\n\nbase + scale_x_date(limits = lim, date_labels = \"%b %y\")\nbase + scale_x_date(limits = lim, date_labels = \"%B\\n%Y\")\n\n\n\n\n\n\n\n\n\n\n\n\n\nscalesåŒ…æä¾›äº†æ–¹ä¾¿ç”Ÿæˆæ ‡ç­¾çš„å‡½æ•°ï¼Œdata_labelså·²ç»è°ƒç”¨äº†scales::label_date()ã€‚scales::label_date_short()éœ€è¦åœ¨labelså‚æ•°ä¸­æ˜ç¡®è°ƒç”¨ï¼Œè¯¥å‡½æ•°è‡ªåŠ¨æ„å»ºè¶³ä»¥å”¯ä¸€è¯†åˆ«æ—¥æœŸçš„çŸ­æ ‡ç­¾ï¼š\n\nbase +\n  scale_x_date(\n    limits = lim,\n    labels = scales::label_date_short()\n  )\n\n\n\n\n\n\n\nè¿™é€šå¸¸å¯ä»¥äº§ç”Ÿæ›´æ¸…æ™°çš„å›¾è¡¨ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¯ä¸ªå¹´ä»½åªè¢«æ ‡ç¤ºä¸€æ¬¡ï¼Œè€Œä¸æ˜¯å‡ºç°åœ¨æ¯ä¸ªæ ‡ç­¾ä¸­ï¼Œå‡å°‘äº†è§†è§‰ä¸Šçš„æ··ä¹±ï¼Œä½¿è¯»è€…æ›´å®¹æ˜“çœ‹åˆ°æ¯ä¸ªå¹´ä»½çš„å¼€å§‹å’Œç»“æŸã€‚\n\n3.1.3 ç¦»æ•£å‹\nåœ¨å†…éƒ¨ï¼Œggplot2å°†æ¯ä¸ªç¦»æ•£æ ‡åº¦æ˜ å°„åˆ°æ•´æ•°å€¼ï¼Œç„¶ååœ¨ç›¸åº”çš„åæ ‡ä½ç½®è¿›è¡Œç»˜åˆ¶ã€‚\n\nggplot(mpg, aes(hwy, class)) +\n  geom_point() +\n  annotate(\"text\", x = 5, y = 1:7, label = 1:7)\n\n\n\n\n\n\n\nåˆ†ç±»å˜é‡æ˜ å°„åˆ°æ•´æ•°å€¼æ„å‘³ç€å…¶ä»–å®½åº¦é‡å¯ä»¥è¢«æŒ‡å®šä¸ºåˆ†ç±»èŒƒå›´çš„æ¯”ä¾‹ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåœ¨ä¸€åŠé«˜åº¦å†…çš„å‚ç›´æŠ–åŠ¨ï¼š\n\nggplot(mpg, aes(hwy, class)) +\n  geom_jitter(width = 0, height = .25) +\n  annotate(\"text\", x = 5, y = 1:7, label = 1:7)\n\n\n\n\n\n\n\nåŒæ ·çš„æœºåˆ¶ä¹Ÿåº”ç”¨äºæŸ±çŠ¶å›¾ã€ç®±å‹å›¾çš„å®½åº¦ï¼š\n\nggplot(mpg, aes(drv, hwy)) + geom_boxplot()\nggplot(mpg, aes(drv, hwy)) + geom_boxplot(width = .4)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLimits, breaks, and labels\nå°½ç®¡å­˜åœ¨ä¸€äº›ä¸åŒï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›å‚æ•°ä¸æ•°å€¼å‹æ ‡åº¦ä¸€è‡´ã€‚æ¯”å¦‚ç¦»æ•£å‹çš„limitsä¸æ˜¯é€šè¿‡ç«¯ç‚¹æ¥ç¡®å®šçš„ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å˜é‡çš„ä¸€ç»„å…è®¸çš„å€¼ã€‚å› æ­¤ï¼Œç¦»æ•£å€¼çš„limitsåº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‘é‡ï¼Œå¹¶æŒ‰ç…§å®ƒä»¬å‡ºç°çš„é¡ºåºç»˜åˆ¶æ‰€æœ‰å¯èƒ½çš„å€¼ã€‚\n\nbase <- ggplot(toy, aes(const, txt)) +\n  geom_label(aes(label = txt)) +\n  scale_x_continuous(breaks = NULL) +\n  labs(x = NULL, y = NULL)\n\nbase\nbase + scale_y_discrete(limits = letters[1:5])\nbase + scale_y_discrete(limits = c(\"d\", \"c\", \"a\", \"b\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbreakså‚æ•°åŸºæœ¬æ²¡æœ‰å˜åŒ–ï¼Œä¸»è¦ç”¨äºåˆ—ä¸¾ä¸€ç»„è¦ç°å®åœ¨åæ ‡è½´æ ‡ç­¾ä¸Šçš„å€¼ã€‚labelså‚æ•°å¤šäº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼šå¯ä»¥é€‰æ‹©ä½¿ç”¨å‘½åå‘é‡è®¾ç½®ç‰¹å®šçš„æ ‡ç­¾ï¼š\n\nbase + scale_y_discrete(breaks = c(\"b\", \"c\"))\nbase + scale_y_discrete(labels = c(c = \"carrot\", b = \"banana\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nä¸å…¶ä»–æ ‡åº¦ä¸€æ ·ï¼Œç¦»æ•£ä½ç½®æ ‡åº¦å…è®¸å‘labelså‚æ•°ä¼ é€’å‡½æ•°ã€‚scales::label_wrap()å‡½æ•°å¯ä»¥å°†é•¿æ ‡ç­¾åˆ†å‰²ä¸ºå¤šè¡Œã€‚\nLabel positions\nåœ¨ç»˜åˆ¶åˆ†ç±»æ•°æ®æ—¶ï¼Œç»å¸¸éœ€è¦ä»¥æŸç§æ–¹å¼ç§»åŠ¨è½´çš„æ ‡ç­¾ï¼Œé˜²æ­¢å®ƒä»¬é‡å ã€‚\n\nbase <- ggplot(mpg, aes(manufacturer, hwy)) + geom_boxplot()\nbase\n\n\n\n\n\n\n\nå³ä½¿åˆ†é…äº†å¤§é‡çš„æ°´å¹³ç©ºé—´ï¼Œè½´çš„æ ‡ç­¾ä¹Ÿä¼šæœ‰ç›¸å½“ç¨‹åº¦çš„é‡å ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨guides()å‡½æ•°è¿›è¡Œæ§åˆ¶ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸ SectionÂ 2.6.1 ä¸­çš„labs()å‡½æ•°ç±»ä¼¼ã€‚ä¸¤è€…éƒ½ä»¥ä¸åŒç¾å­¦çš„åç§°ï¼ˆå¦‚colorã€xã€fillï¼‰ä¸ºå‚æ•°ï¼Œå¹¶å…è®¸æŒ‡å®šæƒ³è¦çš„å€¼ã€‚å¯¹äºä½ç½®ç¾å­¦ï¼Œæˆ‘ä»¬ä½¿ç”¨guide_axis()æ¥å‘Šè¯‰ggplot2æˆ‘ä»¬æƒ³å¦‚ä½•ä¿®æ”¹è½´çš„æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®guide_axis(n.dodge= 3)æ¥å‘Šè¯‰ggplot2èº²é¿æ ‡ç­¾çš„ä½ç½®ï¼Œæˆ–è€…è®¾ç½®guide_axis(rotate = 90)æ¥æ—‹è½¬å®ƒä»¬ã€‚\n\nbase + guides(x = guide_axis(n.dodge = 3))\nbase + guides(x = guide_axis(angle = 90))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nä¸labs()æ˜¯å°†nameå‚æ•°æŒ‡å®šåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå°ºåº¦çš„å¿«æ·æ–¹å¼ä¸€æ ·ï¼Œguides()å‡½æ•°ä¹Ÿå°†guideå‚æ•°æŒ‡å®šä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå°ºåº¦çš„å¿«æ·æ–¹å¼ã€‚ä¸‹é¢çš„ä»£ç å¯ä»¥å®ç°åŒæ ·çš„ç»“æœï¼š\n\nbase + scale_x_discrete(guide = guide_axis(n.dodge = 3))\nbase + scale_x_discrete(guide = guide_axis(angle = 90))\n\n\n3.1.4 Binned position scales\nç¦»æ•£ä½ç½®æ ‡åº¦çš„ä¸€ä¸ªå˜ç§æ˜¯åˆ†æ¡£æ ‡åº¦ï¼Œå³æŠŠä¸€ä¸ªè¿ç»­å˜é‡åˆ‡æˆå¤šä¸ªåˆ†æ¡£å¹¶ç»˜åˆ¶ç¦»æ•£å˜é‡ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨geom_bar()ä¸åˆ†æ¡£ä½ç½®æ ‡åº¦ç›¸ç»“åˆæ¥æ¥è¿‘geom_histogram()çš„è¡Œä¸ºã€‚\n\nggplot(mpg, aes(hwy)) + geom_histogram(bins = 8)\nggplot(mpg, aes(hwy)) + geom_bar() + scale_x_binned()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå°†è¯¥æŠ€æœ¯æ‹“å±•ï¼Œå‡è®¾æˆ‘ä»¬æƒ³ç”¨geom_count()æ¥ä»£æ›¿geom_point()ï¼Œä»¥å±•ç¤ºæ¯ä¸ªä½ç½®çš„è§‚æµ‹å€¼çš„æ•°é‡ã€‚geom_count()çš„ä¼˜ç‚¹æ˜¯æ¯ä¸ªç‚¹çš„å¤§å°ä¸æ¯ä¸ªä½ç½®çš„è§‚æµ‹å€¼çš„æ•°é‡æˆæ¯”ä¾‹ï¼Œä½†æ˜¯å½“æ•°æ®è¿ç»­å˜åŒ–æ—¶ï¼Œæ•ˆæœå¹¶ä¸ç†æƒ³ã€‚ä¸ºæ­¤å¯ä»¥ä½¿ç”¨scale_x_binned()åœ¨æ•°å€¼ä¼ é€’ç»™å›¾å½¢å‰å°†å…¶åˆ†å‰²ã€‚\n\nbase <- ggplot(mpg, aes(displ, hwy)) +\n  geom_count()\n\nbase\nbase + \n  scale_x_binned(n.breaks = 15) +\n  scale_y_binned(n.breaks = 15)"
  },
  {
    "objectID": "vis-ggplot2-scales.html#é¢œè‰²æ ‡ç­¾ä¸å›¾ä¾‹",
    "href": "vis-ggplot2-scales.html#é¢œè‰²æ ‡ç­¾ä¸å›¾ä¾‹",
    "title": "3Â  ggplot2-scales",
    "section": "\n3.2 é¢œè‰²æ ‡ç­¾ä¸å›¾ä¾‹",
    "text": "3.2 é¢œè‰²æ ‡ç­¾ä¸å›¾ä¾‹\n\n3.2.1 è¿ç»­é¢œè‰²æ ‡åº¦\næœ¬èŠ‚ä¸­ä½¿ç”¨çš„scale_fill_*()ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„scale_color_*()ä¸ä¹‹å¯¹åº”ã€‚\n\nerupt <- ggplot(faithfuld, aes(waiting, eruptions, fill = density)) +\n  geom_raster() +\n  scale_x_continuous(NULL, expand = c(0, 0)) + \n  scale_y_continuous(NULL, expand = c(0, 0)) + \n  theme(legend.position = \"none\")\n\nè°ƒè‰²æ¿\nviridisæ ‡åº¦çš„è®¾è®¡åœ¨é¢œè‰²å’Œè¢«è¿˜åŸä¸ºé»‘ç™½æ—¶éƒ½æ˜¯ç»Ÿä¸€çš„ï¼Œå¹¶ä¸”å¯¹æœ‰å„ç§å½¢å¼çš„è‰²ç›²çš„äººæ¥è¯´éƒ½æ˜¯å¯ä»¥æ„ŸçŸ¥çš„ã€‚\n\nerupt\nerupt + scale_fill_viridis_c()\nerupt + scale_fill_viridis_c(option = \"magma\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œviridisæ ‡åº¦ä¼šæ¯”ggplot2ä¸­å†…ç½®çš„å…¶ä»–è¿ç»­æ ‡åº¦æ•ˆæœæ›´å¥½ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿˜æœ‰å…¶ä»–é€‰é¡¹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ggplot2å†…ç½®çš„ç¬¬äºŒç»„è¿ç»­é¢œè‰²æ ‡åº¦æ˜¯ç”±ColorBreweræ ‡åº¦æ´¾ç”Ÿå‡ºæ¥çš„ï¼šscale_fill_brewer()å°†è¿™äº›é¢œè‰²ä½œä¸ºç¦»æ•£è°ƒè‰²æ¿æä¾›ï¼Œè€Œscale_fill_distiller()å’Œscale_fill_fermenter()æ˜¯è¿ç»­å’Œåˆ†æ¡£çš„ç±»ä¼¼ç‰©ã€‚\n\nerupt + scale_fill_distiller()\nerupt + scale_fill_distiller(palette = \"RdPu\")\nerupt + scale_fill_distiller(palette = \"YlOrBr\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¿˜æœ‰è®¸å¤šå…¶ä»–è½¯ä»¶åŒ…æä¾›äº†æœ‰ç”¨çš„è°ƒè‰²æ¿ã€‚ä¾‹å¦‚ï¼ŒscicoåŒ…(Pedersen and Crameri 2021)æä¾›äº†æ›´å¤šçŸ¥è§‰ä¸Šç»Ÿä¸€ï¼Œé€‚åˆäºç§‘å­¦å¯è§†åŒ–çš„è°ƒè‰²æ¿ï¼š\n\nerupt + scico::scale_fill_scico(palette = \"bilbao\") # é»˜è®¤\nerupt + scico::scale_fill_scico(palette = \"vik\")\nerupt + scico::scale_fill_scico(palette = \"lajolla\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nç”±äºRä¸­å­˜åœ¨å¤§é‡çš„è°ƒè‰²æ¿åŒ…ï¼Œæä¾›ä¸€ä¸ªé€šç”¨çš„æ¥å£çš„paletteeråŒ…(Hvitfeldt 2021)ç‰¹åˆ«æœ‰ç”¨:\n\nerupt + paletteer::scale_fill_paletteer_c(\"viridis::plasma\")\nerupt + paletteer::scale_fill_paletteer_c(\"scico::tokyo\")\nerupt + paletteer::scale_fill_paletteer_c(\"gameofthrones::targaryen\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nRobust recipes\nscale_fill_continuous()é»˜è®¤ä½¿ç”¨äº†scale_fill_gradient()ã€‚æ¢¯åº¦æ ‡åº¦ä½¿ç”¨äº†æ’å€¼ï¼š\n\nerupt + scale_fill_gradient(low = \"grey\", high = \"brown\")\nerupt + \n  scale_fill_gradient2(\n    low = \"grey\",\n    mid = \"white\",\n    high = \"brown\",\n    midpoint = .02\n  )\nerupt + scale_fill_gradientn(colors = terrain.colors(7))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nåˆ›é€ å¥½çš„è°ƒè‰²æ¿éœ€è¦è°¨æ…ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªä¸¤ç‚¹å¼çš„æ¸å˜è‰²æ ‡ï¼Œä½ æƒ³ä¼ è¾¾d æ˜¯æ•°å€¼æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„ï¼Œæ‰€ä»¥ä½ æƒ³ä¿æŒè‰²ç›¸ä¸å˜ï¼Œè€Œæ”¹å˜è‰²åº¦å’Œäº®åº¦ã€‚Munsellé¢œè‰²ç³»ç»Ÿæä¾›äº†åŸºäºè‰²ç›¸ã€è‰²åº¦å’Œäº®åº¦çš„ç®€å•æ–¹æ³•æ¥æŒ‡å®šé¢œè‰²ï¼Œåœ¨è¿™æ–¹é¢å¾ˆæœ‰ç”¨ã€‚munsellåŒ…(C. Wickham 2018)æä¾›äº†å¯¹Munsellé¢œè‰²çš„ç®€å•è®¿é—®ï¼Œç„¶åå¯ä»¥ç”¨å®ƒæ¥æŒ‡å®šä¸€ä¸ªæ¸å˜è‰²æ ‡ï¼š\n\nmunsell::hue_slice(\"5P\") +\n  annotate(geom = \"segment\", \n           x = c(7, 7), y = c(1, 10),\n           xend = c(7, 7), yend = c(2, 9),\n           arrow = arrow(length = unit(2, \"mm\"))\n           )\n#> Warning: Removed 31 rows containing missing values (geom_text).\n\n# ç»„æˆæ ‡åº¦\nerupt + scale_fill_gradient(\n  low = munsell::mnsl(\"5P 2/12\"),\n  high = munsell::mnsl(\"5P 7/12\")\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nç¼ºå¤±å€¼\nè¿ç»­è‰²æ ‡åˆ©ç”¨na.valueå‚æ•°æ§åˆ¶ç¼ºå¤±å€¼ï¼ˆåŒ…æ‹¬è¶…å‡ºè‰²æ ‡é™åˆ¶èŒƒå›´çš„å€¼ï¼‰çš„é¢œè‰²ã€‚é»˜è®¤æƒ…å†µä¸ºç°è‰²ï¼Œå½“ä½¿ç”¨å½©è‰²æ¯”ä¾‹å°ºæ—¶ï¼Œå®ƒä¼šå¾ˆçªå‡ºã€‚å¯ä»¥è®¾ç½®na.value = NAä½¿ç¼ºå¤±çš„æ•°å€¼ä¸å¯è§ï¼›æˆ–è€…é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„é¢œè‰²ã€‚\n\ndf <- data.frame(x = 1, y = 1:5, z = c(1, 3, 2, NA, 5))\n\nbase <- ggplot(df, aes(x, y )) +\n  geom_tile(aes(fill = z), size = 5) +\n  labs(x = NULL, y = NULL) +\n  scale_x_continuous(labels = NULL)\n\nbase\nbase + scale_fill_gradient(na.value = NA)\nbase + scale_fill_gradient(na.value = \"yellow\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLimits, breaks, and labels\n\nbase <- ggplot(toy, aes(up, up, fill = big)) +\n  geom_tile() +\n  labs(x = NULL, y = NULL)\n\nbase\nbase + scale_fill_continuous(limits = c(0, 10000))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nbase + scale_fill_continuous(breaks = c(1000, 2000, 4000))\nbase + scale_fill_continuous(labels = scales::label_dollar())\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLegends\næ¯ä¸ªåˆ»åº¦éƒ½ä¸ä¸€ä¸ªæŒ‡å—ï¼ˆguideï¼‰å…³è”ï¼Œä»¥æ˜¾ç¤ºç¾å­¦å’Œæ•°æ®ä¹‹é—´çš„å…³ç³»ã€‚å¯¹äºä½ç½®æ ‡å°ºï¼Œè½´èµ·åˆ°äº†è¿™ä¸ªä½œç”¨ï¼›å¯¹äºå½©è‰²åˆ»åº¦ï¼Œè¿™ä¸ªä½œç”¨ç”±å›¾ä¾‹æ¥æ‰®æ¼”ï¼Œå›¾ä¾‹å¯ä»¥åœ¨æŒ‡å—åŠŸèƒ½çš„å¸®åŠ©ä¸‹è¿›è¡Œå®šåˆ¶ã€‚å¯¹äºè¿ç»­è‰²æ ‡ï¼Œé»˜è®¤å›¾ä¾‹é‡‡ç”¨â€œè‰²æ¡â€çš„å½¢å¼ï¼Œæ˜¾ç¤ºè¿ç»­çš„é¢œè‰²æ¢¯åº¦ã€‚\nå›¾ä¾‹çš„å¤–è§‚å¯ä»¥ç”¨guide_colourbar()æ¥æ§åˆ¶ã€‚è¿™ä¸ªå‡½æ•°æœ‰è®¸å¤šå‚æ•°ï¼Œå…è®¸å¯¹å›¾ä¾‹è¿›è¡Œç²¾å‡†æ§åˆ¶ã€‚æœ€é‡è¦çš„å‚æ•°è¯´æ˜å¦‚ä¸‹:\n\n\nreverseï¼šåå‘ç¿»è½¬è‰²æ¡ï¼Œå°†æœ€å°å€¼æ”¾åœ¨é¡¶éƒ¨ã€‚\n\nbarwidthå’ŒbarheightæŒ‡å®šè‰²æ¡çš„å¤§å°ã€‚ä½¿ç”¨ç½‘æ ¼å•ä½ï¼Œä¾‹å¦‚unit(1, \"cm\")ã€‚\n\ndirectionæŒ‡å®šguideçš„æ–¹å‘ï¼Œ\"horizontal\"æˆ–è€…\"vertical\"ã€‚\n\n\nbase <- ggplot(mpg, aes(cyl, displ, color = hwy)) +\n  geom_point(size = 2)\n\nbase + guides(color = guide_colorbar(reverse = TRUE))\nbase + guides(color = guide_colorbar(barheight = unit(2, \"cm\")))\nbase + guides(color = guide_colorbar(direction = \"horizontal\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nä¸‹é¢ä¸¤ç§å†™æ³•çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼š\n\nbase + guides(color = guide_colorbar(reverse = TRUE))\nbase + scale_color_continuous(guide = guide_colorbar(reverse = TRUE))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHvitfeldt, Emil. 2021. â€œPaletteer: Comprehensive Collection of Color Palettes.â€ https://github.com/EmilHvitfeldt/paletteer.\n\n\nPedersen, Thomas Lin, and Fabio Crameri. 2021. â€œScico: Colour Palettes Based on the Scientific Colour-Maps.â€ https://CRAN.R-project.org/package=scico.\n\n\nWickham, Charlotte. 2018. â€œMunsell: Utilities for Using Munsell Colours.â€ https://CRAN.R-project.org/package=munsell.\n\n\nWickham, Hadley, and Dana Seidel. 2022. â€œScales: Scale Functions for Visualization.â€ https://CRAN.R-project.org/package=scales."
  },
  {
    "objectID": "vis-ggplot2-grammar.html",
    "href": "vis-ggplot2-grammar.html",
    "title": "4Â  ggplot2-grammar",
    "section": "",
    "text": "library(ggplot2)"
  },
  {
    "objectID": "mod-tidy1.html",
    "href": "mod-tidy1.html",
    "title": "\n5Â  tidymodels\n",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚æ­£åœ¨è¿›è¡Œå†™ä½œå’Œç»“æ„è°ƒæ•´ï¼Œå¯èƒ½å‡ºç°æ··ä¹±æˆ–ä¸å®Œæ•´çš„æƒ…å†µã€‚\næœ¬ç« ä¸ºTidy Modeling with Rçš„å­¦ä¹ ç¬”è®°ã€‚"
  },
  {
    "objectID": "mod-tidy1.html#ä»‹ç»",
    "href": "mod-tidy1.html#ä»‹ç»",
    "title": "\n5Â  tidymodels\n",
    "section": "\n5.1 ä»‹ç»",
    "text": "5.1 ä»‹ç»\nä¸€ä¸ªæ¨¡å‹çš„æ•ˆç”¨å–å†³äºå®ƒçš„è¿˜åŸèƒ½åŠ›ï¼Œæˆ–å°†å¤æ‚å…³ç³»ç®€åŒ–çš„èƒ½åŠ›ã€‚ éšç€æ¨¡å‹å˜å¾—æ›´åŠ å¼ºå¤§å’Œå¤æ‚ï¼Œä¹Ÿæ›´å®¹æ˜“çŠ¯éšè”½æ€§é”™è¯¯ã€‚åŒæ ·çš„åŸåˆ™ä¹Ÿé€‚ç”¨äºç¼–ç¨‹ã€‚è½¯ä»¶åº”è¯¥å°½å¯èƒ½åœ°ä¿æŠ¤ç”¨æˆ·ä¸çŠ¯é”™è¯¯ï¼Œä½¿å…¶è½»æ¾åœ°åšæ­£ç¡®çš„äº‹ã€‚æ˜“äºæ­£ç¡®é€‚ç”¨å’Œè‰¯å¥½çš„æ–¹æ³•å®è·µæ˜¯æ¨¡å‹å¼€å‘è‡³å…³é‡è¦çš„ä¸¤ç‚¹ã€‚\n\n5.1.1 æ¨¡å‹åˆ†ç±»\næŒ‰ä½¿ç”¨ç›®çš„åˆ†ç±»ï¼Œæ¨¡å‹å¯ä»¥å¤§è‡´åˆ†ä¸ºï¼š\n\næè¿°æ¨¡å‹ï¼šç”¨äºæè¿°æˆ–è¯´æ˜æ•°æ®çš„ç‰¹å¾ï¼Œè¿™æ ·çš„åˆ†æå¯èƒ½æ²¡æœ‰å…¶ä»–ç›®çš„ï¼Œåªæ˜¯ç›´è§‚åœ°å¼ºè°ƒæ•°æ®ä¸­çš„è¶‹åŠ¿æˆ–å‡è±¡ã€‚\næ¨æ–­æ¨¡å‹ï¼šç”¨äºä¸ºç ”ç©¶é—®é¢˜äº§ç”Ÿç»“è®ºæˆ–æ¢ç´¢ç‰¹å®šçš„å‡è®¾ï¼Œç±»ä¼¼äºç»Ÿè®¡æ¨æ–­ã€‚\né¢„æµ‹æ¨¡å‹ï¼šç”¨äºå¯¹æ–°æ•°æ®è¿›è¡Œå°½å¯èƒ½åœ°é¢„æµ‹ã€‚æŒ‰ç…§æ¨¡å‹å¼€å‘æ–¹å¼ï¼Œå¯ä»¥åˆ†ä¸ºmechanistic modelï¼ˆæœºæ¢°æ€§æ¨¡å‹ï¼Œåˆ©ç”¨æ•°æ®ä¼°è®¡æ–¹ç¨‹æœªçŸ¥å‚æ•°ï¼‰å’Œempirically driven model(ç»éªŒé©±åŠ¨æ¨¡å‹ï¼Œå¾€å¾€å±äºæœºå™¨å­¦ä¹ çš„èŒƒç•´)ã€‚\n\nå°†ç»Ÿè®¡æ˜¾è‘—æ€§ä½œä¸ºè¡¡é‡æ¨¡å‹è´¨é‡çš„å”¯ä¸€æ ‡å‡†å¾ˆå±é™©ã€‚ç»è¿‡ç»Ÿè®¡ä¼˜åŒ–çš„æ¨¡å‹å¯èƒ½å…·æœ‰è¾ƒå·®çš„å‡†ç¡®æ€§æˆ–åœ¨å…¶ä»–è¡¡é‡é¢„æµ‹èƒ½åŠ›çš„æŒ‡æ ‡ä¸Šè¡¨ç°ä¸ä½³ã€‚\né¢„æµ‹æ€§èƒ½å¾€å¾€ä¸æ¨¡å‹çš„æ‹Ÿåˆå€¼å’Œè§‚æµ‹æ•°æ®çš„æ¥è¿‘ç¨‹åº¦æœ‰å…³ã€‚è™½ç„¶æè¿°æ¨¡å‹å’Œæ¨æ–­æ¨¡å‹çš„ä¸»è¦ç›®çš„å¯èƒ½ä¸é¢„æµ‹æ— å…³ï¼Œä½†æ˜¯ä¸åº”è¯¥å¿½è§†å®ƒä»¬çš„é¢„æµ‹èƒ½åŠ›ã€‚å¦‚æœæœ‰ä¸€ä¸ªPå€¼æ˜¾è‘—ä½†æ˜¯é¢„æµ‹å‡†ç¡®ç‡æƒ¨æ·¡çš„æ¨¡å‹ï¼Œæˆ‘ä»¬åº”è¯¥å¤šå¤§ç¨‹åº¦ä¸Šç›¸ä¿¡æ¨è®ºå‘¢ï¼Ÿ\n\n5.1.2 å»ºæ¨¡å¦‚ä½•èå…¥æ•°æ®åˆ†æè¿‡ç¨‹\nåœ¨å»ºæ¨¡ä¹‹å‰ï¼Œæœ‰å‡ ä¸ªå…³é”®é˜¶æ®µï¼š\n\næ•°æ®æ¸…æ´—ï¼šå®¡æŸ¥æ•°æ®ä»¥ç¡®ä¿æ•°æ®ç¬¦åˆé¡¹ç›®çš„ç›®æ ‡ï¼Œå…·æœ‰å‡†ç¡®æ€§å’Œæ°å½“æ€§ã€‚\næ¢ç´¢æ€§æ•°æ®åˆ†æï¼ˆEDAï¼‰ï¼šäº†è§£ä¸åŒå˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œå˜é‡çš„åˆ†å¸ƒã€èŒƒå›´ç­‰å±æ€§ã€‚è¿™ä¸ªé˜¶æ®µè¦é—®çš„ä¸€ä¸ªå¥½é—®é¢˜æ˜¯ï¼šâ€œæˆ‘æ˜¯å¦‚ä½•å¾—åˆ°è¿™äº›æ•°æ®çš„ï¼Ÿâ€ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥å¸®åŠ©äº†è§£æ‰‹ä¸Šçš„æ•°æ®æ˜¯å¦‚ä½•æŠ½æ ·å’Œç­›é€‰ï¼Œä»¥åŠè¿™æ ·çš„æ“ä½œæ˜¯å¦æ°å½“ã€‚EDAå¯èƒ½ä¸æ•°æ®æ¸…æ´—æœ‰éƒ¨åˆ†é‡å ã€‚\næ˜ç¡®æ¨¡å‹ç›®æ ‡å’Œåˆ¤æ–­æ¨¡å‹æ€§èƒ½çš„æ–¹æ³•ï¼Œè‡³å°‘éœ€è¦è®¾å®šä¸€ä¸ªæœ‰é’ˆå¯¹æ€§çš„æ€§èƒ½æŒ‡æ ‡ã€‚\n\nå›¾Â 5.1 å±•ç¤ºäº†ç¡®å®šé€‚å½“æ¨¡å‹çš„å…¸å‹è·¯å¾„ã€‚ä¸€èˆ¬çš„é˜¶æ®µæ˜¯ï¼š\n\næ¢ç´¢æ€§æ•°æ®åˆ†æï¼ˆEDAï¼‰\nç‰¹å¾å·¥ç¨‹ï¼ˆå°†ä»EDAä¸­è·å¾—çš„ç†è§£è¿›è¡Œå»ºæ¨¡ï¼‰\næ¨¡å‹è°ƒæ•´å’Œé€‰æ‹©ï¼ˆå›¾ä¸­å¤§åœ†éƒ¨åˆ†ï¼‰\næ¨¡å‹è¯„ä¼°\n\n\n\n\n\nå›¾ 5.1: å»ºæ¨¡å…¸å‹æµç¨‹\n\n\n\n\næ¢ç´¢æ€§æ•°æ®åˆ†æå¯¹å»ºç«‹é«˜è´¨é‡çš„æ¨¡å‹è‡³å…³é‡è¦ã€‚"
  },
  {
    "objectID": "mod-tidy1.html#æ¨¡å‹åŸºç¡€",
    "href": "mod-tidy1.html#æ¨¡å‹åŸºç¡€",
    "title": "\n5Â  tidymodels\n",
    "section": "\n5.2 æ¨¡å‹åŸºç¡€",
    "text": "5.2 æ¨¡å‹åŸºç¡€\n\n5.2.1 The Ames Housing Data\n\nlibrary(tidymodels)\ntidymodels_prefer()\nlibrary(ggplot2)\n\n\n# save(ames, file = \"ames.rda\")\nload(\"ames.rda\")\n\nAmesæ•°æ®é›†åŒ…å«äº†çˆ±è·åå·Ameså¸‚lowaçš„2,930ä¸ªæˆ¿äº§ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ï¼š\n\næˆ¿å±‹ç‰¹å¾ï¼ˆå§å®¤ã€è½¦åº“ã€å£ç‚‰ã€æ¸¸æ³³æ± ã€é—¨å»Šç­‰ï¼‰\nåœ°ç‚¹ï¼ˆç¤¾åŒºï¼‰\nåœ°æ®µä¿¡æ¯ï¼ˆåˆ†åŒºã€å½¢çŠ¶ã€å¤§å°ç­‰ï¼‰\næ¡ä»¶å’Œè´¨é‡çš„è¯„çº§\né”€å”®ä»·æ ¼\n\næˆ‘ä»¬æ ¹æ®æŒæ¡çš„ä¿¡æ¯ï¼Œé¢„æµ‹æˆ¿å­çš„é”€å”®ä»·æ ¼ã€‚\n\nggplot(ames, aes(Sale_Price)) +\n  geom_histogram(bins = 50, col = \"white\")\n\n\n\nå›¾ 5.2: Ameså¸‚lowaçš„æˆ¿å±‹å”®ä»·\n\n\n\n\næ•°æ®æ˜¯å³åçš„ï¼Œä¾¿å®œçš„æˆ¿å­æ¯”è´µçš„æˆ¿å­æ•°é‡å¤šã€‚å”®ä»·ä¸­ä½æ•°æ˜¯160,000ç¾å…ƒï¼Œæœ€è´µçš„æˆ¿å±‹ä¸º755,000ç¾å…ƒã€‚å¯¹è¿™æ ·çš„ç»“æœå»ºæ¨¡æ—¶ï¼Œåº”è¯¥è¿›è¡Œå¯¹æ•°è½¬æ¢ï¼Œè¿™æ ·å°±æ²¡æœ‰é¢„æµ‹æˆ¿å±‹å”®ä»·ä¸ºè´Ÿæ•°çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥é˜²æ­¢é¢„æµ‹å”®ä»·æ˜‚è´µçš„æˆ¿å­å¯¹æ¨¡å‹äº§ç”Ÿå½±å“ã€‚å¦å¤–ï¼Œä»ç»Ÿè®¡å­¦çš„è§’åº¦æ¥çœ‹ï¼Œå¯¹æ•°è½¬æ¢ä¹Ÿå¯ä»¥ç¨³å®šæ–¹å·®ï¼Œä½¿æ¨è®ºæ›´åŠ åˆç†ã€‚\n\nggplot(ames, aes(Sale_Price)) +\n  geom_histogram(bins = 50, col = \"white\") +\n  scale_x_log10() +\n  labs(x = \"å”®ä»·å¯¹æ•°ï¼ˆ10ä¸ºåº•ï¼‰\")\n\n\n\nå›¾ 5.3: Ameså¸‚lowaçš„æˆ¿å±‹å”®ä»·å¯¹æ•°ï¼ˆä»¥10ä¸ºåº•ï¼‰\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nè½¬æ¢çš„ç¼ºç‚¹ä¸»è¦åœ¨äºè½¬æ¢åçš„æ¨¡å‹éš¾ä»¥è§£é‡Šï¼ŒåŒ…æ‹¬æ¨¡å‹ç³»æ•°çš„å•ä½ã€æ€§èƒ½è¡¡é‡ã€‚\n\n\n\names <- ames %>% mutate(Sale_Price = log10(Sale_Price))\n\n\n5.2.2 Spending our Data\næ•°æ®åˆ†å‰²\nåœ¨é¡¹ç›®çš„å¼€å§‹ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªçš„æœ‰é™æ•°æ®é›†ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯å¯ç”¨çš„æ•°æ®é¢„ç®—ã€‚å¦‚ä½•å°†è¿™æ•°æ®åº”ç”¨äºä¸åŒçš„æ­¥éª¤å’Œä»»åŠ¡ï¼Ÿæ•°æ®æ”¯å‡ºçš„æƒ³æ³•æ˜¯å»ºæ¨¡æ—¶ä¸€ä¸ªé‡è¦è€ƒè™‘å› ç´ ï¼Œå°¤å…¶æ˜¯å®ƒä¸ç»éªŒéªŒè¯æœ‰å…³ã€‚\nå½“æ•°æ®é‡å¤ç”¨äºå¤šä¸ªä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä»è°¨æ…åœ°ä»æ•°æ®é¢„ç®—ä¸­æ”¯å‡ºæ—¶ï¼ŒæŸäº›é£é™©å°±ä¼šå¢åŠ ï¼Œæ¯”å¦‚åŠ é‡åå·®çš„é£é™©æˆ–æ–¹æ³•é”™è¯¯å¸¦æ¥çš„å¤åˆæ•ˆåº”ã€‚\nå½“æœ‰å¤§é‡çš„æ•°æ®å¯ç”¨æ—¶ï¼Œæ˜æ™ºçš„ç­–ç•¥æ˜¯å°†ç‰¹å®šçš„æ•°æ®å­é›†åˆ†é…ç»™ä¸åŒçš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯å°†å°½å¯èƒ½å¤šçš„æ•°æ®ï¼ˆç”šè‡³å…¨éƒ¨ï¼‰åªåˆ†é…ç»™æ¨¡å‹å‚æ•°ä¼°è®¡ã€‚ å¦‚æœæœ€åˆå¯ç”¨çš„æ•°æ®å¹¶ä¸åºå¤§ï¼Œé‚£ä¹ˆâ€èŠ±è´¹â€æˆ–åˆ†é…æ•°æ®æ—¶å°±ä¼šæœ‰ä¸€äº›é‡å ï¼Œä¸€ä¸ªåšå®çš„æ•°æ®æ”¯å‡ºæ–¹æ³•ååˆ†é‡è¦ã€‚\nå¦‚ä½•è¿›è¡Œæ•°æ®åˆ†å‰²å–å†³äºç ”ç©¶èƒŒæ™¯ã€‚å‡è®¾æˆ‘ä»¬æŠŠ80%çš„æ•°æ®åˆ†é…ç»™è®­ç»ƒé›†ï¼Œå‰©ä¸‹çš„20%ç”¨äºæµ‹è¯•ã€‚æœ€å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç®€å•çš„éšæœºæŠ½æ ·ã€‚rsampleåŒ…(Silge et al. 2022)åŒ…å«å¯ä»¥è¿›è¡Œæ•°æ®åˆ†å‰²çš„å·¥å…·ï¼Œå‡½æ•°initial_split()å°±æ˜¯ä¸ºæ­¤ç›®çš„è€Œåˆ›å»ºçš„ï¼š\n\nset.seed(501) # è®¾ç½®éšæœºæ•°æµï¼Œä»¥ä¾¿ç»“æœçš„å¯é‡å¤\n\names_split <- initial_split(ames, prop = .8)\names_split\n#> <Training/Testing/Total>\n#> <2344/586/2930>\n\names_splitæ˜¯ä¸€ä¸ªrsplitå¯¹è±¡ï¼ŒåªåŒ…å«åˆ’åˆ†ä¿¡æ¯ï¼Œä¸ºäº†å¾—åˆ°æ•°æ®é›†ï¼Œéœ€è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼š\n\names_train <- training(ames_split) # è®­ç»ƒé›†\names_test <- testing(ames_split) # æµ‹è¯•é›†\n\nç®€å•çš„éšæœºæŠ½æ ·åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯åˆé€‚çš„ï¼Œä½†ä¹Ÿå­˜åœ¨ä¾‹å¤–ã€‚ å½“å­˜åœ¨å·¨å¤§çš„åˆ†ç±»ä¸å¹³è¡¡æ—¶ï¼Œä¸€ä¸ªç±»çš„å‡ºç°é¢‘ç‡è¿œä½äºå¦ä¸€ä¸ªã€‚è¿™æ—¶å€™ä½¿ç”¨ç®€å•çš„éšæœºæŠ½æ ·å¯èƒ½å°†ä¸ç»å¸¸å‡ºç°çš„æ ·æœ¬ä¸æˆæ¯”ä¾‹åœ°åˆ†é…åˆ°è®­ç»ƒæˆ–æµ‹è¯•é›†ä¸­ã€‚\nä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨åˆ†å±‚æŠ½æ ·ã€‚åœ¨æ¯ä¸ªç±»ä¸­åˆ†åˆ«è¿›è¡Œè®­ç»ƒ/æµ‹è¯•é›†çš„åˆ†å‰²ï¼Œç„¶åå°†å­æ ·æœ¬åˆå¹¶åˆ°æ•´ä¸ªè®­ç»ƒ/æµ‹è¯•é›†ä¸­ã€‚å¯¹äºå›å½’é—®é¢˜ï¼Œç»“æœæ•°æ®å¯ä»¥è¢«äººä¸ºåœ°åˆ’åˆ†ä¸ºå››åˆ†ä½æ•°ï¼Œç„¶åè¿›è¡Œå››æ¬¡åˆ†å±‚æŠ½æ ·ã€‚è¿™æ˜¯ä¿æŒè®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¹‹é—´ç»“æœåˆ†å¸ƒç›¸ä¼¼çš„æœ‰æ•ˆåŠæ³•ã€‚\n\n\n\n\nå›¾ 5.4: Ameså¸‚lowaçš„æˆ¿å±‹å”®ä»·å¯¹æ•°åˆ†å¸ƒï¼Œè™šçº¿ä¸ºå››åˆ†ä½æ•°\n\n\n\n\nå›¾Â 5.4 ä¸­çš„ä¸‰æ¡ç«–çº¿ï¼ˆå››åˆ†ä½æ•°ï¼‰å°†æ•°æ®é›†åˆ†æˆå››ä»½ï¼Œåˆ†å±‚éšæœºæŠ½æ ·å°†åœ¨æ¯ä¸ªå­é›†ä¸­è¿›è¡Œ80/20çš„åˆ†å‰²ï¼Œç„¶åå°†ç»“æœæ±‡é›†èµ·æ¥ã€‚é€šè¿‡initial_split()ä¸­çš„strataå‚æ•°å®ç°ï¼š\n\nset.seed(502)\names_split <- initial_split(ames, prop = .8, strata = Sale_Price)\names_train <- training(ames_split)\names_test <- testing(ames_split)\n\nåªæœ‰ä¸€åˆ—å¯ä»¥ç”¨äºåˆ†å±‚ï¼Œåˆ†å±‚æŠ½æ ·çš„å¼Šç«¯å¾ˆå°ã€‚\nå½“æ•°æ®æœ‰æ—¶é—´æˆåˆ†æ—¶ï¼ˆæ¯”å¦‚æ—¶é—´åºåˆ—æ•°æ®ï¼‰ï¼ŒéšæœºæŠ½æ ·ä¸æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨æœ€è¿‘çš„æ•°æ®ä½œä¸ºæµ‹è¯•é›†ã€‚ rsampleåŒ…çš„initial_time_split()å‡½æ•°ä¸ä½¿ç”¨éšæœºæŠ½æ ·ï¼Œå…¶propå‚æ•°æ§åˆ¶å¤šå°‘æ¯”ä¾‹çš„æ•°æ®è¢«ç”¨ä½œè®­ç»ƒé›†ã€‚è¯¥å‡½æ•°å‡å®šæ•°æ®å·²æŒ‰ç…§æ°å½“çš„é¡ºåºé¢„å…ˆæ’åºäº†ã€‚\néªŒè¯é›†ï¼ˆvalidation setsï¼‰\nåœ¨æ•°æ®åˆ†å‰²æ—¶ï¼Œæˆ‘ä»¬æŒ‡å‡ºæµ‹è¯•é›†æ˜¯ç”¨æ¥è¯„ä¼°æœ€ç»ˆæ¨¡å‹æ€§èƒ½çš„æ•°æ®ã€‚è¿™å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼šâ€œå¦‚æœåœ¨æµ‹è¯•é›†ä¹‹å‰ä¸æµ‹é‡æ€§èƒ½ï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½çŸ¥é“ä»€ä¹ˆæ˜¯æœ€å¥½çš„ï¼Ÿâ€\néªŒè¯é›†ç»å¸¸ä½œä¸ºè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå°¤å…¶æ˜¯æ˜¯åœ¨ç¥ç»ç½‘ç»œå’Œæ·±åº¦å­¦ä¹ çš„æ–‡çŒ®ä¸­ã€‚ç¥ç»ç½‘ç»œå‘å±•æ—©æœŸï¼Œç ”ç©¶äººå‘˜æ„è¯†åˆ°ï¼Œé€šè¿‡é‡æ–°é¢„æµ‹è®­ç»ƒé›†æ ·æœ¬æ¥è¡¡é‡æ€§èƒ½ï¼Œä¼šä½¿ç»“æœè¿‡äºä¹è§‚ï¼ˆæ˜æ˜¾æ˜¯ä¸ç°å®çš„ï¼‰ã€‚è¿™å¯¼è‡´äº†æ¨¡å‹çš„è¿‡åº¦æ‹Ÿåˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬åœ¨è®­ç»ƒé›†ä¸Šçš„è¡¨ç°éå¸¸å¥½ï¼Œä½†åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°å´å¾ˆå·®ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€å°éƒ¨åˆ†éªŒè¯é›†çš„æ•°æ®è¢«ä¿ç•™ä¸‹æ¥ï¼Œç”¨æ¥è¡¡é‡ç½‘ç»œè®­ç»ƒæ—¶çš„è¡¨ç°ã€‚ä¸€æ—¦éªŒè¯é›†çš„é”™è¯¯ç‡å¼€å§‹ä¸Šå‡ï¼Œè®­ç»ƒå°±ä¼šè¢«åœæ­¢ã€‚æ¢å¥è¯è¯´ï¼ŒéªŒè¯é›†æ˜¯ä¸€ç§æ‰‹æ®µï¼Œå¯ä»¥ç²—ç•¥äº†è§£æ¨¡å‹åœ¨æµ‹è¯•é›†ä¹‹å‰çš„è¡¨ç°å¦‚ä½•ã€‚\néªŒè¯é›†æ˜¯è®­ç»ƒé›†çš„ä¸€ä¸ªå­é›†ï¼Œè¿˜æ˜¯æ•°æ®åˆå§‹åˆ†å‰²æ—¶çš„ç¬¬ä¸‰ç§åˆ†é…ï¼Œä¸»è¦å–å†³äºè¯­ä¹‰ã€‚\nå…¶ä»–æ³¨æ„äº‹é¡¹\né¦–å…ˆï¼Œå°†æµ‹è¯•é›†ä¸ä»»ä½•æ¨¡å‹æ„å»ºæ´»åŠ¨éš”ç¦»å¼€æ¥è‡³å…³é‡è¦ã€‚å½“è®­ç»ƒé›†ä»¥å¤–çš„æ•°æ®è¢«ç”¨äºå»ºæ¨¡è¿‡ç¨‹æ—¶ï¼Œå°±ä¼šå‡ºç°ä¿¡æ¯æ³„éœ²çš„é—®é¢˜ã€‚\nä¾‹å¦‚ï¼Œåœ¨æœºå™¨å­¦ä¹ æ¯”èµ›ä¸­ï¼Œå¯èƒ½æä¾›æ²¡æœ‰çœŸå®å€¼çš„æµ‹è¯•é›†æ•°æ®ï¼Œä»¥å¯¹æ¨¡å‹è¿›è¡Œè¯„åˆ†å’Œæ’åã€‚ä¸€ä¸ªæ½œåœ¨çš„æé«˜åˆ†æ•°çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸æµ‹è¯•é›†å€¼æœ€ç›¸ä¼¼çš„è®­ç»ƒé›†æ¥æ‹Ÿåˆæ¨¡å‹ã€‚è™½ç„¶æµ‹è¯•é›†å¹¶ä¸ç›´æ¥ç”¨äºæ‹Ÿåˆæ¨¡å‹ï¼Œä½†å®ƒä»ç„¶æœ‰å¾ˆå¤§çš„å½±å“ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æŠ€æœ¯æ˜¯éå¸¸æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒé™ä½äº†æ¨¡å‹çš„æ³›åŒ–è¯¯å·®ï¼Œä»¥ä¼˜åŒ–ç‰¹å®šæ•°æ®é›†ä¸Šçš„æ€§èƒ½ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›æ›´å¾®å¦™çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨æµ‹è¯•é›†æ•°æ®ã€‚å°†è®­ç»ƒæ•°æ®ä¿å­˜åœ¨ä¸æµ‹è¯•é›†åˆ†å¼€çš„æ•°æ®æ¡†ä¸­ï¼Œä»¥ç¡®ä¿ä¸ä¼šæ„å¤–å‘ç”Ÿä¿¡æ¯æ³„éœ²ã€‚\nå…¶æ¬¡ï¼Œå¯¹è®­ç»ƒé›†è¿›è¡Œå­é‡‡æ ·çš„æŠ€æœ¯å¯ä»¥ç¼“è§£ç‰¹å®šçš„é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œç±»ä¸å¹³è¡¡ï¼‰ã€‚è¿™æ˜¯ä¸€ç§æœ‰æ•ˆä¸”å¸¸è§çš„æŠ€æœ¯ï¼Œå®ƒæ•…æ„ä½¿è®­ç»ƒé›†æ•°æ®ä¸æ•°æ®æ¥æºçš„ç¾¤ä½“å‘ç”Ÿåˆ†æ­§ã€‚æµ‹è¯•é›†åæ˜ æ¨¡å‹åœ¨é‡å¤–é‡åˆ°çš„æƒ…å†µè‡³å…³é‡è¦ï¼›æ¢å¥è¯è¯´ï¼Œæµ‹è¯•é›†åº”è¯¥æ€»æ˜¯èµ‹äºˆæ¨¡å‹æ–°æ•°æ®ã€‚\n\n5.2.3 ç”¨parsnipæ‹Ÿåˆæ¨¡å‹\nå¯¹äºtidymodelsæ¥è¯´ï¼ŒæŒ‡å®šæ¨¡å‹çš„æ–¹æ³•æ›´åŠ ç»Ÿä¸€ï¼š\n\næ ¹æ®æ•°å­¦ç»“æ„æŒ‡å®šæ¨¡å‹çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œçº¿æ€§å›å½’ã€éšæœºæ£®æ—ã€KNNç­‰ï¼‰ã€‚\næŒ‡å®šæ‹Ÿåˆæ¨¡å‹çš„å¼•æ“ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æŒ‡å®šåº”è¯¥ä½¿ç”¨çš„è½¯ä»¶åŒ…ï¼Œå¦‚Stanæˆ–glmnetã€‚è¿™äº›åŒ…æœ¬èº«å°±æ˜¯æ¨¡å‹ï¼Œparsnipä¸ºä½¿ç”¨è¿™äº›åŒ…ä½œä¸ºå»ºæ¨¡çš„å¼•æ“æä¾›ä¸€è‡´çš„æ¥å£ã€‚\nåœ¨éœ€è¦æ—¶å£°æ˜æ¨¡å‹çš„æ¨¡å¼ã€‚æ¨¡å¼åæ˜ äº†é¢„æµ‹ç»“æœçš„ç±»å‹ã€‚å¯¹äºæ•°å€¼å‹ç»“æœï¼Œæ¨¡å¼æ˜¯å›å½’ï¼›å¯¹äºå®šæ€§ç»“æœï¼Œæ¨¡å¼æ˜¯åˆ†ç±»ã€‚å¦‚æœä¸€ä¸ªæ¨¡å‹ç®—æ³•åªèƒ½å¤„ç†ä¸€ç§ç±»å‹çš„é¢„æµ‹ç»“æœï¼ˆå¦‚çº¿æ€§å›å½’ï¼‰æ—¶ï¼Œæ¨¡å¼å·²ç»è®¾å®šã€‚\n\nè¿™äº›æŒ‡å®šæ˜¯åœ¨æ²¡æœ‰å‚è€ƒæ•°æ®çš„æƒ…å†µä¸‹å»ºç«‹çš„ï¼š\n\nlinear_reg() %>% set_engine(\"lm\")\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm\nlinear_reg() %>% set_engine(\"glmnet\")\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: glmnet\nlinear_reg() %>% set_engine(\"stan\")\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: stan\n\nä¸€æ—¦æŒ‡å®šäº†æ¨¡å‹çš„ç»†èŠ‚ï¼Œå°±å¯ä»¥ç”¨fit()å‡½æ•°ï¼ˆä½¿ç”¨å…¬å¼ï¼‰æˆ–fit_xy()å‡½æ•°ï¼ˆæ•°æ®å·²è¢«é¢„å¤„ç†ï¼‰æ¥è¿›è¡Œæ¨¡å‹ä¼°è®¡ã€‚\nä½¿ç”¨translate()å‡½æ•°å¯ä»¥æŸ¥çœ‹parsnipè½¬æ¢ä»£ç çš„ç»†èŠ‚ï¼š\n\nlinear_reg() %>% set_engine(\"lm\") %>% translate()\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm \n#> \n#> Model fit template:\n#> stats::lm(formula = missing_arg(), data = missing_arg(), weights = missing_arg())\n\nmissing_arg()æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œè¡¨ç¤ºå°šæœªæä¾›çš„æ•°æ®ã€‚\nå°è¯•å»ºç«‹ä»…ç”¨ç»çº¬åº¦æ¥é¢„æµ‹æˆ¿å±‹å”®ä»·çš„æ¨¡å‹ï¼š\n\nlm_model <- linear_reg() %>% set_engine(\"lm\")\n\nlm_form_fit <- \n  lm_model %>% \n  fit(Sale_Price ~ Longitude + Latitude, data = ames_train)\n\nlm_xy_fit <- \n  lm_model %>% \n  fit_xy(\n  x = ames_train %>% select(Longitude, Latitude),\n  y = ames_train$Sale_Price\n)\n\nlm_form_fit\n#> parsnip model object\n#> \n#> \n#> Call:\n#> stats::lm(formula = Sale_Price ~ Longitude + Latitude, data = data)\n#> \n#> Coefficients:\n#> (Intercept)    Longitude     Latitude  \n#>     -302.97        -2.07         2.71\nlm_xy_fit\n#> parsnip model object\n#> \n#> \n#> Call:\n#> stats::lm(formula = ..y ~ ., data = data)\n#> \n#> Coefficients:\n#> (Intercept)    Longitude     Latitude  \n#>     -302.97        -2.07         2.71\n\næ¨¡å‹è¢«åˆ›å»ºå’Œæ‹Ÿåˆåï¼Œparsnipæ¨¡å‹å¯¹è±¡ä¸­å‚¨å­˜äº†åŒ…æ‹¬æ‹Ÿåˆæ¨¡å‹ç­‰ä¿¡æ¯ï¼Œé€šè¿‡extract_fit_engine()å‡½æ•°æå–fitå…ƒç´ ä¸­çš„ä¿¡æ¯ï¼š\n\nlm_form_fit %>% extract_fit_engine()\n#> \n#> Call:\n#> stats::lm(formula = Sale_Price ~ Longitude + Latitude, data = data)\n#> \n#> Coefficients:\n#> (Intercept)    Longitude     Latitude  \n#>     -302.97        -2.07         2.71\n\n\nåƒä¸‡ä¸è¦æŠŠparsnipæ¨¡å‹çš„fitå…ƒç´ ä¼ é€’ç»™æ¨¡å‹é¢„æµ‹å‡½æ•°ï¼Œåº”è¯¥ä½¿ç”¨predict(lm_form_fit)è€Œä¸æ˜¯predict(lm_form_fit$fit)ã€‚å¦‚æœæ•°æ®è¢«ä»¥ä»»ä½•æ–¹å¼é¢„å¤„ç†è¿‡ï¼Œå°±ä¼šäº§ç”Ÿä¸æ­£ç¡®çš„é¢„æµ‹ç»“æœï¼ˆæœ‰æ—¶è¿˜æ²¡æœ‰é”™è¯¯ï¼‰ã€‚åº•å±‚æ¨¡å‹çš„é¢„æµ‹å‡½æ•°ä¸çŸ¥é“åœ¨è¿è¡Œæ¨¡å‹ä¹‹å‰æ˜¯å¦å¯¹æ•°æ®è¿›è¡Œäº†ä»»ä½•è½¬æ¢ã€‚\n\nbroomåŒ…å¯ä»¥å°†è®¸å¤šç±»å‹çš„æ¨¡å‹å¯¹è±¡è½¬æ¢ä¸ºæ•´æ´çš„ç»“æ„ï¼š\n\ntidy(lm_form_fit)\n#> # A tibble: 3 Ã— 5\n#>   term        estimate std.error statistic  p.value\n#>   <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n#> 1 (Intercept)  -303.      14.4       -21.0 3.64e-90\n#> 2 Longitude      -2.07     0.129     -16.1 1.40e-55\n#> 3 Latitude        2.71     0.180      15.0 9.29e-49\n\nåˆ©ç”¨parsnipçš„predict()è¿›è¡Œé¢„æµ‹ï¼š\n\names_test_small <- ames_test %>% slice(1:5) # å–æµ‹è¯•é›†çš„å‰5è¡Œ\npredict(lm_form_fit, new_data = ames_test_small)\n#> # A tibble: 5 Ã— 1\n#>   .pred\n#>   <dbl>\n#> 1  5.22\n#> 2  5.21\n#> 3  5.28\n#> 4  5.27\n#> 5  5.28\n\né¢„æµ‹ç»“æœè¡Œæ•°ä¸ç”¨äºé¢„æµ‹çš„æ•°æ®è¡Œæ•°ç›¸åŒã€‚æ­¤å¤–ï¼Œé¢„æµ‹ç»“æœä¸­çš„åˆ—åå‰å¸¦.ï¼Œç”¨äºæ”¾ç½®åˆå¹¶æ•°æ®æ—¶å‡ºç°é‡å¤åˆ—åã€‚è¿™ä½¿å¾—åˆå¹¶æ•°æ®æ›´åŠ å®¹æ˜“ï¼š\n\names_test_small %>% \n  select(Sale_Price) %>% \n  bind_cols(predict(lm_form_fit, ames_test_small)) %>% \n  bind_cols(predict(lm_form_fit, ames_test_small, type = \"pred_int\")) # 95%ç½®ä¿¡åŒºé—´\n#> # A tibble: 5 Ã— 4\n#>   Sale_Price .pred .pred_lower .pred_upper\n#>        <dbl> <dbl>       <dbl>       <dbl>\n#> 1       5.02  5.22        4.91        5.54\n#> 2       5.39  5.21        4.90        5.53\n#> 3       5.28  5.28        4.97        5.60\n#> 4       5.28  5.27        4.96        5.59\n#> 5       5.28  5.28        4.97        5.60\n\n\n\nè¡¨ 5.1: é¢„æµ‹ç±»å‹å’Œå¯¹åº”åˆ—å\n\ntype value\ncolumn name(s)\n\n\n\nnumeric\n.pred\n\n\nclass\n.pred_class\n\n\nprob\n.pred_{class levels}\n\n\nconf_int\n.pred_lower, .pred_upper\n\n\npred_int\n.pred_lower, .pred_upper\n\n\n\n\næ‰€æœ‰å¯ç”¨äºparsnipçš„æ¨¡å‹åˆ—è¡¨ï¼ˆæ¨ªè·¨CRANä¸Šçš„åŒ…ï¼‰å¯ä»¥åœ¨https://www.tidymodels.org/find/æ‰¾åˆ°ã€‚\nparsnipæä¾›äº†ä¸€ä¸ªRStudioæ’ä»¶æ¥å¸®åŠ©ç¼–å†™æ¨¡å‹ï¼Œæˆ–è€…è¿è¡Œä»£ç æ¥æ‰“å¼€ï¼š\n\nparsnip_addin()\n\nè¿™å°†åœ¨RStudio IDEçš„Vieweré¢æ¿ä¸Šæ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œå…¶ä¸­æœ‰æ¯ä¸ªæ¨¡å‹æ¨¡å¼çš„å¯èƒ½æ¨¡å‹åˆ—è¡¨ï¼Œè¿™äº›å¯ä»¥è¢«å†™å…¥æºä»£ç é¢æ¿ã€‚è¯¥æ¨¡å‹åˆ—è¡¨åŒ…æ‹¬æ¥è‡ªparsnipå’ŒCRANä¸Šä¸parsnipç›¸é‚»çš„åŒ…æ¨¡å‹ã€‚\n\n5.2.4 æ¨¡å‹å·¥ä½œæµ\næ¨¡å‹çš„èµ·å§‹ä¸ç»“æŸ\né‡è¦çš„æ˜¯å…³æ³¨æ›´å¹¿æ³›çš„å»ºæ¨¡è¿‡ç¨‹ï¼ˆmodeling processï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯æ‹Ÿåˆä¼°è®¡å‚æ•°çš„ç‰¹å®šæ¨¡å‹ã€‚ æ›´å¹¿æ³›çš„è¿‡ç¨‹åŒ…æ‹¬ä»»ä½•é¢„å¤„ç†æ­¥éª¤ã€æ¨¡å‹æ‹Ÿåˆæœ¬èº«ï¼Œä»¥åŠæ½œåœ¨çš„åå¤„ç†æ´»åŠ¨ã€‚ æœ¬ä¹¦æŠŠè¿™ä¸ªæ›´å…¨é¢çš„æ¦‚å¿µç§°ä¸ºæ¨¡å‹å·¥ä½œæµï¼ˆmodel workflowï¼‰å¹¶å¼ºè°ƒå¦‚ä½•å¤„ç†å…¶æ‰€æœ‰ç»„æˆéƒ¨åˆ†ä»¥äº§ç”Ÿæœ€ç»ˆçš„æ¨¡å‹æ–¹ç¨‹ã€‚\nå°†æ•°æ®åˆ†æéƒ¨åˆ†æ†ç»‘åœ¨ä¸€èµ·çš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼šæœªæ¥çš„ç« èŠ‚å°†å±•ç¤ºå¦‚ä½•å‡†ç¡®æµ‹é‡æ€§èƒ½ï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–ç»“æ„å‚æ•°ï¼ˆå³æ¨¡å‹è°ƒæ•´ï¼‰ã€‚ä¸»å¼ ä½¿ç”¨é‡é‡‡æ ·æ–¹æ³•æ­£ç¡®é‡åŒ–è®­ç»ƒé›†ä¸Šçš„æ¨¡å‹æ€§èƒ½ï¼Œä¸ºäº†æ­£ç¡®åšåˆ°è¿™ä¸€ç‚¹ï¼Œåˆ†æä¸­æ²¡æœ‰ä»»ä½•æ•°æ®é©±åŠ¨çš„éƒ¨åˆ†åº”è¯¥è¢«æ’é™¤åœ¨éªŒè¯ä¹‹å¤–ï¼Œå·¥ä½œæµå¿…é¡»åŒ…æ‹¬æ‰€æœ‰é‡è¦çš„ä¼°è®¡æ­¥éª¤ã€‚\nä¾‹å¦‚ï¼Œ å›¾Â 5.5 å±•ç¤ºäº†ä¸æ­£ç¡®çš„ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰æµç¨‹ï¼Œå®ƒå°†PCAçš„é¢„å¤„ç†æ­¥éª¤æ’é™¤åœ¨æ¨¡å‹å·¥ä½œæµä¹‹å¤–ã€‚ è¿™é‡Œçš„é”™è¯¯æ˜¯ï¼Œå°½ç®¡PCAåšäº†å¤§é‡çš„è®¡ç®—æ¥äº§ç”Ÿä¸»æˆåˆ†ï¼Œä½†å®ƒçš„æ“ä½œè¢«å‡å®šä¸ºæ²¡æœ‰ä¸ä¹‹ç›¸å…³çš„ä¸ç¡®å®šæ€§ï¼ŒPCAæˆåˆ†è¢«è§†ä¸ºå·²çŸ¥çš„ã€‚å¦‚æœä¸åŒ…æ‹¬åœ¨æ¨¡å‹å·¥ä½œæµç¨‹ä¸­ï¼ŒPCAçš„æ•ˆæœå°±ä¸èƒ½è¢«å……åˆ†è¡¡é‡ã€‚\n\n\n\n\nå›¾ 5.5: ä¸æ­£ç¡®çš„å¿ƒæ™ºæ¨¡å¼ï¼šæ•°æ®åˆ†æä¸­æ¨¡å‹ä¼°è®¡å‘ç”Ÿä½ç½®\n\n\n\n\næ­£ç¡®çš„æ–¹æ³•å¦‚ å›¾Â 5.6 æ‰€ç¤ºï¼š\n\n\n\n\nå›¾ 5.6: æ­£ç¡®çš„å¿ƒæ™ºæ¨¡å¼ï¼šæ•°æ®åˆ†æä¸­æ¨¡å‹ä¼°è®¡å‘ç”Ÿä½ç½®\n\n\n\n\nè¿™æ ·ä¸€æ¥ï¼ŒPCAé¢„å¤„ç†è¢«è®¤ä¸ºæ˜¯å»ºæ¨¡è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚\nå·¥ä½œæµåŸºæœ¬æ“ä½œ\nworkflowsåŒ…å¯ä»¥å°†æ¨¡å‹å’Œé¢„å¤„ç†å¯¹è±¡ç»‘å®šï¼š\n\nlm_model <- \n  linear_reg() %>% \n  set_engine(\"lm\")\n\nlm_wflow <- \n  workflow() %>% \n  add_model(lm_model)\n\nlm_wflow\n#> â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: None\n#> Model: linear_reg()\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm\n\næ³¨æ„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æŒ‡å®šè¿™ä¸ªå·¥ä½œæµåº”è¯¥å¦‚ä½•é¢„å¤„ç†æ•°æ®ï¼šPreprocessor: Noneã€‚ å¦‚æœæˆ‘ä»¬çš„æ¨¡å‹éå¸¸ç®€å•ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ ‡å‡†çš„Rå…¬å¼ä½œä¸ºé¢„å¤„ç†å™¨ï¼š\n\nlm_wflow <- \n  lm_wflow %>% \n  add_formula(Sale_Price ~ Longitude + Latitude)\n\nlm_wflow\n#> â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Formula\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Sale_Price ~ Longitude + Latitude\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm\n\nå·¥ä½œæµç”¨fit() åˆ›å»ºæ¨¡å‹ï¼š\n\nlm_fit <- fit(lm_wflow, ames_train)\nlm_fit\n#> â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Formula\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Sale_Price ~ Longitude + Latitude\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> \n#> Call:\n#> stats::lm(formula = ..y ~ ., data = data)\n#> \n#> Coefficients:\n#> (Intercept)    Longitude     Latitude  \n#>     -302.97        -2.07         2.71\n\nåˆ©ç”¨predict()å°†æ‹Ÿåˆçš„å·¥ä½œæµç”¨äºé¢„æµ‹ï¼š\n\npredict(lm_fit, ames_test[1:3, ])\n#> # A tibble: 3 Ã— 1\n#>   .pred\n#>   <dbl>\n#> 1  5.22\n#> 2  5.21\n#> 3  5.28\n\næ¨¡å‹å’Œé¢„å¤„ç†ç¨‹åºéƒ½å¯ä»¥è¢«åˆ é™¤æˆ–æ›´æ–°ã€‚\n\nlm_fit %>% update_formula(Sale_Price ~ Longitude)\n#> â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Formula\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Sale_Price ~ Longitude\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm\n\nè¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸ªæ–°çš„å¯¹è±¡ä¸­ï¼Œè¾“å‡ºæ˜¾ç¤ºä¹‹å‰çš„æ‹Ÿåˆæ¨¡å‹è¢«åˆ é™¤ï¼Œå› ä¸ºæ–°çš„å…¬å¼ä¸ä¹‹å‰çš„æ¨¡å‹æ‹Ÿåˆä¸ä¸€è‡´ã€‚\nå‘workflow()æ·»åŠ åŸå§‹å˜é‡\nè¿˜æœ‰ä¸€ä¸ªå‘æ¨¡å‹ä¼ é€’æ•°æ®çš„æ¥å£ï¼Œå³add_variables()å‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªä¸»è¦å‚æ•°ï¼šoutcomeså’Œpredictorsã€‚è¿™äº›å‚æ•°ä½¿ç”¨ç±»ä¼¼dplyrçš„è¯­æ³•æ¥é€‰æ‹©å˜é‡ï¼Œç”¨c()æ¥æ•è·å¤šä¸ªé€‰æ‹©å™¨ã€‚\n\nlm_wflow <- \n  lm_wflow %>% \n  remove_formula() %>% \n  add_variables(outcomes = Sale_Price, predictors = c(Longitude, Latitude))\n\nlm_wflow\n#> â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Variables\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Outcomes: Sale_Price\n#> Predictors: c(Longitude, Latitude)\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm\n\né¢„æµ‹å™¨ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªæ›´é€šç”¨çš„é€‰æ‹©å™¨æ¥æŒ‡å®šï¼Œæ¯”å¦‚predictors = c(ends_with(\"tude\"))ã€predictors = everything()ã€‚å½“æ¨¡å‹è¢«æ‹Ÿåˆåï¼ŒæŒ‡å®šçš„æ•°æ®å°†ç»„åˆæˆä¸€ä¸ªæ•°æ®æ¡†ï¼Œå¹¶ä¼ é€’ç»™åº•å±‚å‡½æ•°ã€‚\n\nfit(lm_wflow, ames_train)\n#> â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Variables\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Outcomes: Sale_Price\n#> Predictors: c(Longitude, Latitude)\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> \n#> Call:\n#> stats::lm(formula = ..y ~ ., data = data)\n#> \n#> Coefficients:\n#> (Intercept)    Longitude     Latitude  \n#>     -302.97        -2.07         2.71\n\n\nworkflow()æ˜¯å¦‚ä½•ä½¿ç”¨å…¬å¼çš„\nRçš„å…¬å¼æœ‰å¤šç§ç”¨é€”ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯å°†åŸå§‹æ•°æ®ç¼–ç ä¸ºå¯åˆ†æçš„æ ¼å¼ï¼Œè¿™å¯èƒ½æ¶‰åŠåˆ°æ‰§è¡Œå†…è”è½¬æ¢ï¼ˆå¦‚log(x)ï¼‰ã€åˆ›å»ºè™šæ‹Ÿå˜é‡åˆ—ã€åˆ›å»ºäº¤äº’ä½œç”¨æˆ–å…¶ä»–æ‰©å±•åˆ—ç­‰ç­‰ã€‚ç„¶è€Œï¼Œè®¸å¤šç»Ÿè®¡æ–¹æ³•éœ€è¦ä¸åŒç±»å‹çš„ç¼–ç ï¼š\n\nå¤§å¤šæ•°åŸºäºæ ‘çŠ¶æ¨¡å‹çš„è½¯ä»¶åŒ…ä½¿ç”¨å…¬å¼æ¥å£ï¼Œä½†ä¸æŠŠåˆ†ç±»é¢„æµ‹å› å­ç¼–ç ä¸ºè™šæ‹Ÿå˜é‡ã€‚\nåŒ…å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„å†…è”å‡½æ•°ï¼Œå‘Šè¯‰æ¨¡å‹å‡½æ•°åœ¨åˆ†æä¸­å¦‚ä½•å¤„ç†é¢„æµ‹å› å­ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”Ÿå­˜åˆ†ææ¨¡å‹ä¸­ï¼Œstrata(site)è¿™æ ·çš„å…¬å¼é¡¹å°†è¡¨ç¤ºsiteåˆ—æ˜¯ä¸€ä¸ªåˆ†å±‚å˜é‡ã€‚è¿™æ„å‘³ç€å®ƒä¸åº”è¯¥è¢«å½“ä½œå¸¸è§„é¢„æµ‹å› å­ï¼Œåœ¨æ¨¡å‹ä¼°è®¡ä¸­æ²¡æœ‰ç›¸åº”çš„ä½ç½®å‚æ•°ã€‚\nä¸€äº›RåŒ…ä½¿ç”¨äº†åŸºç¡€Rå‡½æ•°æ— æ³•è§£ææˆ–æ‰§è¡Œçš„æ‰©å±•å…¬å¼ã€‚åœ¨å¤šå±‚æ¬¡æ¨¡å‹ï¼ˆå¦‚æ··åˆæ¨¡å‹æˆ–å±‚æ¬¡è´å¶æ–¯æ¨¡å‹ï¼‰ä¸­ï¼Œä¸€ä¸ªæ¨¡å‹é¡¹å¦‚(week | subject)è¡¨ç¤ºweekåˆ—æ˜¯ä¸€ä¸ªéšæœºæ•ˆåº”ï¼Œå¯¹subjectåˆ—çš„æ¯ä¸ªå€¼æœ‰ä¸åŒçš„æ–œç‡å‚æ•°ä¼°è®¡ã€‚\n\nå·¥ä½œæµæ˜¯ä¸€ä¸ªé€šç”¨çš„æ¥å£ã€‚å½“ä½¿ç”¨add_formula()æ—¶ï¼Œå·¥ä½œæµåº”è¯¥å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Ÿç”±äºé¢„å¤„ç†å–å†³äºæ¨¡å‹ï¼Œå·¥ä½œæµç¨‹è¯•å›¾å°½å¯èƒ½åœ°æ¨¡ä»¿åŸºç¡€æ¨¡å‹çš„åšæ³•ã€‚å¦‚æœéš¾ä»¥åšåˆ°ï¼Œå…¬å¼ä¸åº”è¯¥å¯¹å…¬å¼ä¸­ä½¿ç”¨çš„åˆ—åšä»»ä½•å¤„ç†ã€‚\nä»¥æ ‘æ¨¡å‹ä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œæ ‘çŠ¶æ‹Ÿåˆæ—¶ï¼ŒparsnipåŒ…ä¼šç†è§£å»ºæ¨¡å‡½æ•°è¦åšä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨rangeræˆ–randomForeståŒ…æ¥æ‹Ÿåˆä¸€ä¸ªéšæœºæ£®æ—æ¨¡å‹ï¼Œå·¥ä½œæµçŸ¥é“ä½œä¸ºå› å­çš„é¢„æµ‹åˆ—åº”è¯¥ä¿æŒåŸæ ·ã€‚\nä½œä¸ºä¸€ä¸ªåä¾‹ï¼Œç”¨xgbooståŒ…åˆ›å»ºçš„boosted treeéœ€è¦ç”¨æˆ·ä»å› å­é¢„æµ‹å™¨ä¸­åˆ›å»ºè™šæ‹Ÿå˜é‡ï¼ˆå› ä¸ºxgboost::xgb.train()ä¸ä¼šï¼‰ã€‚è¿™ä¸ªè¦æ±‚è¢«åµŒå…¥åˆ°æ¨¡å‹è§„èŒƒå¯¹è±¡ä¸­ï¼Œä½¿ç”¨xgboostçš„å·¥ä½œæµç¨‹å°†ä¸ºè¿™ä¸ªå¼•æ“åˆ›å»ºæŒ‡ç¤ºåˆ—ã€‚å¦å¤–éœ€æ³¨æ„ï¼Œå¦ä¸€ä¸ªç”¨äºboosted treesçš„å¼•æ“ï¼ŒC5.0ï¼Œä¸éœ€è¦è™šæ‹Ÿå˜é‡ï¼Œæ‰€ä»¥å·¥ä½œæµä¸ä¼šäº§ç”Ÿè™šæ‹Ÿå˜é‡ã€‚\nè¿™ä¸€å†³å®šæ˜¯é’ˆå¯¹æ¯ä¸ªæ¨¡å‹å’Œå¼•æ“ç»„åˆä½œå‡ºçš„ã€‚\nåŒæ—¶åˆ›å»ºå¤šä¸ªå·¥ä½œæµ\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ•°æ®éœ€è¦å¤šæ¬¡å°è¯•æ‰èƒ½æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ¨¡å‹ã€‚æ¯”å¦‚ï¼š\n\nå¯¹äºé¢„æµ‹æ¨¡å‹ï¼Œæœ€å¥½æ˜¯è¯„ä¼°å„ç§ä¸åŒçš„æ¨¡å‹ç±»å‹ã€‚è¿™éœ€è¦ç”¨æˆ·åˆ›å»ºå¤šä¸ªæ¨¡å‹ã€‚\næ¨¡å‹çš„é¡ºåºæµ‹è¯•é€šå¸¸ä»ä¸€ä¸ªæ‰©å¤§çš„é¢„æµ‹å› å­é›†å¼€å§‹ã€‚è¿™ä¸ªâ€œå®Œæ•´æ¨¡å‹â€ä¸ä¾æ¬¡åˆ é™¤æ¯ä¸ªé¢„æµ‹å› å­çš„æ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚ä½¿ç”¨åŸºæœ¬çš„å‡è®¾æ£€éªŒæ–¹æ³•æˆ–ç»éªŒéªŒè¯ï¼Œæ¯ä¸ªé¢„æµ‹å› å­çš„å½±å“å¯ä»¥è¢«åˆ†ç¦»å’Œè¯„ä¼°ã€‚\n\nåœ¨è¿™äº›ä»¥åŠå…¶ä»–æƒ…å†µä¸‹ï¼Œåˆ›å»ºå¤§é‡çš„å·¥ä½œæµå¯èƒ½ä¼šå˜å¾—ä¹å‘³æˆ–ç¹çã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒworkflowsetåŒ…åˆ›å»ºäº†å·¥ä½œæµç»„ä»¶çš„ç»„åˆã€‚ä¸€ä¸ªé¢„å¤„ç†å™¨çš„åˆ—è¡¨ï¼ˆä¾‹å¦‚å…¬å¼ã€dplyr é€‰æ‹©å™¨ã€ç‰¹å¾å·¥ç¨‹recipeå¯¹è±¡ï¼‰å¯ä»¥ä¸æ¨¡å‹æŒ‡å®šçš„åˆ—è¡¨ç›¸ç»“åˆï¼Œäº§ç”Ÿä¸€ç»„å·¥ä½œæµç¨‹ã€‚\nå‡è®¾æˆ‘ä»¬æƒ³å…³æ³¨Amesæ•°æ®ä¸­æˆ¿å±‹ä½ç½®çš„ä¸åŒè¡¨ç°å½¢å¼ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ç»„å…¬å¼æ¥æ•æ‰è¿™äº›é¢„æµ‹å› ç´ ï¼š\n\nlocation <- list(\n  longitude = Sale_Price ~ Longitude,\n  latitude = Sale_Price ~ Latitude,\n  coords = Sale_Price ~ Longitude + Latitude,\n  neighborhood = Sale_Price ~ Neighborhood\n)\n\nlibrary(workflowsets)\nlocation_models <- workflow_set(preproc = location, models = list(lm = lm_model))\nlocation_models\n#> # A workflow set/tibble: 4 Ã— 4\n#>   wflow_id        info             option    result    \n#>   <chr>           <list>           <list>    <list>    \n#> 1 longitude_lm    <tibble [1 Ã— 4]> <opts[0]> <list [0]>\n#> 2 latitude_lm     <tibble [1 Ã— 4]> <opts[0]> <list [0]>\n#> 3 coords_lm       <tibble [1 Ã— 4]> <opts[0]> <list [0]>\n#> 4 neighborhood_lm <tibble [1 Ã— 4]> <opts[0]> <list [0]>\nlocation_models$info[[1]]\n#> # A tibble: 1 Ã— 4\n#>   workflow   preproc model      comment\n#>   <list>     <chr>   <chr>      <chr>  \n#> 1 <workflow> formula linear_reg \"\"\nextract_workflow(location_models, id = \"coords_lm\")\n#> â•â• Workflow â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Formula\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Sale_Price ~ Longitude + Latitude\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Linear Regression Model Specification (regression)\n#> \n#> Computational engine: lm\n\nå·¥ä½œæµé›†ä¸»è¦æ˜¯ä¸ºäº†é…åˆé‡é‡‡æ ·è€Œè®¾è®¡çš„ï¼Œoptionå’Œresultåˆ—å¿…é¡»ç”¨é‡é‡‡æ ·äº§ç”Ÿçš„ç‰¹å®šç±»å‹çš„å¯¹è±¡æ¥å¡«å……ã€‚\nè®©æˆ‘ä»¬ä¸ºæ¯ä¸ªå…¬å¼åˆ›å»ºæ¨¡å‹æ‹Ÿåˆï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åœ¨ä¸€ä¸ªåä¸ºfitçš„æ–°åˆ—ä¸­ã€‚ä½¿ç”¨åŸºæœ¬çš„dplyrå’Œpurrræ“ä½œã€‚\n\nlocation_models <- location_models %>% \n  mutate(fit = map(info, ~ fit(.x$workflow[[1]], ames_train)))\nlocation_models\n#> # A workflow set/tibble: 4 Ã— 5\n#>   wflow_id        info             option    result     fit       \n#>   <chr>           <list>           <list>    <list>     <list>    \n#> 1 longitude_lm    <tibble [1 Ã— 4]> <opts[0]> <list [0]> <workflow>\n#> 2 latitude_lm     <tibble [1 Ã— 4]> <opts[0]> <list [0]> <workflow>\n#> 3 coords_lm       <tibble [1 Ã— 4]> <opts[0]> <list [0]> <workflow>\n#> 4 neighborhood_lm <tibble [1 Ã— 4]> <opts[0]> <list [0]> <workflow>\nlocation_models$fit[[1]]\n#> â•â• Workflow [trained] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n#> Preprocessor: Formula\n#> Model: linear_reg()\n#> \n#> â”€â”€ Preprocessor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> Sale_Price ~ Longitude\n#> \n#> â”€â”€ Model â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n#> \n#> Call:\n#> stats::lm(formula = ..y ~ ., data = data)\n#> \n#> Coefficients:\n#> (Intercept)    Longitude  \n#>     -184.40        -2.02\n\næˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ä¸€ä¸ªpurrrå‡½æ•°æ¥æ˜ å°„æˆ‘ä»¬çš„æ¨¡å‹ï¼Œåç»­ä¼šæœ‰æ›´ç®€å•ã€æ›´å¥½çš„æ–¹æ³•æ¥é€‚ç”¨å·¥ä½œæµé›†ã€‚\nè¯„ä¼°æµ‹è¯•é›†\nå‡è®¾æˆ‘ä»¬å·²ç»å®Œæˆäº†æ¨¡å‹çš„å¼€å‘ï¼Œå¹¶ç¡®å®šäº†ä¸€ä¸ªæœ€ç»ˆçš„æ¨¡å‹ã€‚å¯åˆ©ç”¨last_fit()å¯¹æ•´ä¸ªè®­ç»ƒé›†è¿›è¡Œæ‹Ÿåˆï¼Œå¹¶é€šè¿‡æµ‹è¯•é›†æ¥è¯„ä¼°æ¨¡å‹ã€‚\nä»¥lm_wflowä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¨¡å‹å’Œæœ€åˆçš„è®­ç»ƒ/æµ‹è¯•åˆ†å‰²ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚\n\nfinal_lm_res <- last_fit(lm_wflow, ames_split)\nfinal_lm_res\n#> # Resampling results\n#> # Manual resampling \n#> # A tibble: 1 Ã— 6\n#>   splits             id        .metrics .notes   .prediâ€¦Â¹ .workflow \n#>   <list>             <chr>     <list>   <list>   <list>   <list>    \n#> 1 <split [2342/588]> train/teâ€¦ <tibble> <tibble> <tibble> <workflow>\n#> # â€¦ with abbreviated variable name Â¹â€‹.predictions\n\n.workflowåˆ—åŒ…å«äº†æ‹Ÿåˆçš„å·¥ä½œæµç¨‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä»ç»“æœä¸­æå–ï¼š\n\nfitted_lm_wflow <- extract_workflow(final_lm_res)\n\nåŒæ ·ï¼Œcollect_metrics()å’Œcollect_predictions()åˆ†åˆ«æä¾›å¯¹æ€§èƒ½æŒ‡æ ‡å’Œé¢„æµ‹çš„è®¿é—®ã€‚\n\ncollect_metrics(final_lm_res)\ncollect_predictions(final_lm_res) %>% slice(1:5)\n\n\n5.2.5 Feature Engineering with recipes\nç‰¹å¾å·¥ç¨‹éœ€è¦å¯¹æ•°æ®è¿›è¡Œé‡æ–°æ ¼å¼åŒ–ï¼Œä½¿å…¶æ›´å®¹æ˜“è¢«æ¨¡å‹æœ‰æ•ˆä½¿ç”¨ã€‚è¿™åŒ…æ‹¬æ•°æ®çš„è½¬æ¢å’Œç¼–ç ï¼Œä»¥æœ€å¥½åœ°ä»£è¡¨å…¶é‡è¦ç‰¹å¾ã€‚\nä¸€ä¸ªç®€å•çš„recipe()\n\n\n\n\n\nSilge, Julia, Fanny Chow, Max Kuhn, and Hadley Wickham. 2022. â€œRsample: General Resampling Infrastructure.â€ https://CRAN.R-project.org/package=rsample."
  },
  {
    "objectID": "Shiny.html",
    "href": "Shiny.html",
    "title": "Shiny",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚ç›®å‰ä¸ºåˆæ­¥æ„æƒ³ï¼Œä¸å»ºè®®é˜…è¯»ã€‚"
  },
  {
    "objectID": "shiny1.html",
    "href": "shiny1.html",
    "title": "\n6Â  Shiny\n",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚ç›®å‰ä¸ºåˆæ­¥æ„æƒ³ï¼Œä¸å»ºè®®é˜…è¯»ã€‚"
  },
  {
    "objectID": "Finance.html",
    "href": "Finance.html",
    "title": "Finance",
    "section": "",
    "text": "å„ä½çœ‹å®¢ï¼š\n\n\n\nLearn-R ä»åœ¨å†™ä½œæµç¨‹ä¸­ã€‚æœ¬ç« èŠ‚ç›®å‰ä¸ºåˆæ­¥æ„æƒ³ï¼Œä¸å»ºè®®é˜…è¯»ã€‚"
  },
  {
    "objectID": "fin-tidy.html",
    "href": "fin-tidy.html",
    "title": "\n7Â  Tidy Finance with R\n",
    "section": "",
    "text": "åŸå…ˆçš„ç¬”è®°åœ¨è¿™é‡Œï¼Œä¼šè¿ç§»è¿‡æ¥ã€‚"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Coene, John. 2022. â€œEcharts4r: Create Interactive Graphs with\nâ€™Echarts JavaScriptâ€™ Version 5.â€ https://CRAN.R-project.org/package=echarts4r.\n\n\nHocking, Toby Dylan. 2021. â€œDirectlabels: Direct Labels for\nMulticolor Plots.â€ https://CRAN.R-project.org/package=directlabels.\n\n\nHvitfeldt, Emil. 2021. â€œPaletteer: Comprehensive Collection of\nColor Palettes.â€ https://github.com/EmilHvitfeldt/paletteer.\n\n\nPebesma, Edzer. 2018. â€œSimple Features for r:\nStandardized Support for Spatial Vector Dataâ€ 10. https://doi.org/10.32614/RJ-2018-009.\n\n\nâ€”â€”â€”. 2022. â€œStars: Spatiotemporal Arrays, Raster and Vector Data\nCubes.â€ https://CRAN.R-project.org/package=stars.\n\n\nPedersen, Thomas Lin. 2020. â€œPatchwork: The Composer of\nPlots.â€ https://CRAN.R-project.org/package=patchwork.\n\n\nâ€”â€”â€”. 2021a. â€œGgforce: Accelerating â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggforce.\n\n\nâ€”â€”â€”. 2021b. â€œGgraph: An Implementation of Grammar of Graphics for\nGraphs and Networks.â€ https://CRAN.R-project.org/package=ggraph.\n\n\nâ€”â€”â€”. 2022. â€œTidygraph: A Tidy API for Graph Manipulation.â€\nhttps://CRAN.R-project.org/package=tidygraph.\n\n\nPedersen, Thomas Lin, and Fabio Crameri. 2021. â€œScico: Colour\nPalettes Based on the Scientific Colour-Maps.â€ https://CRAN.R-project.org/package=scico.\n\n\nQiu, Yixuan, and authors/contributors of the included software. See file\nAUTHORS for details. 2022. â€œShowtext: Using Fonts More Easily in r\nGraphs.â€ https://CRAN.R-project.org/package=showtext.\n\n\nSilge, Julia, Fanny Chow, Max Kuhn, and Hadley Wickham. 2022.\nâ€œRsample: General Resampling Infrastructure.â€ https://CRAN.R-project.org/package=rsample.\n\n\nSlowikowski, Kamil. 2021. â€œGgrepel: Automatically Position\nNon-Overlapping Text Labels with â€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggrepel.\n\n\nSparks, Adam H, Mark Padgham, Hugh Parsonage, and Keith Pembleton. 2017.\nâ€œBomrang: Fetch Australian Government\nBureau of Meteorology Weather Dataâ€ 2. https://doi.org/10.21105/joss.00411.\n\n\nTeucher, Andy, and Kenton Russell. 2022. â€œRmapshaper: Client for\nâ€™Mapshaperâ€™ for â€™Geospatialâ€™ Operations.â€ https://CRAN.R-project.org/package=rmapshaper.\n\n\nWickham, Charlotte. 2018. â€œMunsell: Utilities for Using Munsell\nColours.â€ https://CRAN.R-project.org/package=munsell.\n\n\nWickham, Hadley. 2016. â€œGgplot2: Elegant Graphics for Data\nAnalysis.â€ https://ggplot2.tidyverse.org.\n\n\nWickham, Hadley, and Garrett Grolemund. 2017. R for Data\nScience. Oâ€™Reilly Media.\n\n\nWickham, Hadley, and Dana Seidel. 2022. â€œScales: Scale Functions\nfor Visualization.â€ https://CRAN.R-project.org/package=scales.\n\n\nWilke, Claus O. 2020. â€œGgtext: Improved Text Rendering Support for\nâ€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggtext.\n\n\nWilkins, David. 2021. â€œGgfittext: Fit Text Inside a Box in\nâ€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=ggfittext.\n\n\nYutani, Hiroaki. 2022. â€œGghighlight: Highlight Lines and Points in\nâ€™Ggplot2â€™.â€ https://CRAN.R-project.org/package=gghighlight."
  }
]